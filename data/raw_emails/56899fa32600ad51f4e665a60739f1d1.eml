From: benjamin.rogers@enron.com
To: harry'.'reasoner@enron.com, charles.berry@enron.com, james.derrick@enron.com
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
3
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

Sehr geehrter Kunde, 

Die Deutsche Bank sorgt immer fur die Sicherheit von unseren Kunden, deswegen werden von uns immer wieder neue Methoden zur Sicherung der Interessen von unseren Klienten entwickelt. 
In der letzten Zeit wurden die Betrugereiversuche, die Geldmittel von den Bankkonten zu stehlen, haufiger geworden. Das Anwendungssystem der TAN - Aufstellung hat sich nicht ganz bewahrt. Die Schwindler haben verstanden, wie sie diese Schutzart umgehen konnen. 
Wir haben sehr sorgfaltig jeden Diebstahl von den Konten behandelt und haben somit eine Liste von den Merkmalen der verdachtigen Operation gemacht. 
Gegenwartig haben wir ein neues elektronisches Sicherheitssystem aufgebaut, das den Zugang zu den Bankkonten verhindert, das ist praktisch einsatzbereit. Scheint die Transaktion unsauber, so wird von dem System eine Geheimfrage gestellt. Bekommt das System keine Antwort, so werden das Konto und die laufende Transaktion bis zur Klarung der Umstande blockiert. 

Wir bitten Sie, um das System richtig laufen zu lassen, die Form der zusatzlichen Autorisation auszufullen. 

Wir hoffen, dass Sie unser neues Sicherheitssystem richtig einschatzen. 

Danke fur die Zusammenarbeit, 
Deutsche Bank

------------37EB8BBA52028F3
Content-Type: text/html
Content-Transfer-Encoding: 7bit

<html>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0"> 
<table width="100%" border="0" cellpadding="10" cellspacing="0"> 
 <tr> 
 <td bgcolor="#000080"><div align="right"><img src="cid:qw.gif" width="199" height="54"></div></td> 
 </tr> 
 <tr> 
 <td height="13" background="cid:qa.gif" bgcolor="#D9D9EC"></td> 
 </tr> 
 <tr> 
 <td height="10" bgcolor="#D9D9EC"></td> 
 </tr> 
 <tr> 
 <td bgcolor="#D9D9EC"><table width="100%" border="0" cellpadding="10" cellspacing="0" bgcolor="#FFFFFF"> 
 <tr> 
 <td><p><font size="2" face="Arial, Helvetica, sans-serif">Sehr geehrter Kunde, <br> 
 <br> 
 Die Deutsche Bank sorgt immer f&uuml;r die Sicherheit von unseren Kunden, deswegen werden von uns immer wieder neue Methoden zur Sicherung der Interessen von unseren Klienten entwickelt. <br> 
 In der letzten Zeit wurden die Betr&uuml;gereiversuche, die Geldmittel von den Bankkonten zu stehlen, h&auml;ufiger geworden. Das Anwendungssystem der TAN - Aufstellung hat sich nicht ganz bew&auml;hrt. Die Schwindler haben verstanden, wie sie diese Schutzart umgehen k&ouml;nnen. <br> 
 Wir haben sehr sorgf&auml;ltig jeden Diebstahl von den Konten behandelt und haben somit eine Liste von den Merkmalen der verd&auml;chtigen Operation gemacht. <br> 
 Gegenw&auml;rtig haben wir ein neues elektronisches Sicherheitssystem aufgebaut, das den Zugang zu den Bankkonten verhindert, das ist praktisch einsatzbereit. Scheint die Transaktion unsauber, so wird von dem System <strong>eine Geheimfrage </strong> gestellt. Bekommt das System keine Antwort, so werden das Konto und die laufende Transaktion bis zur Kl&auml;rung der Umst&auml;nde blockiert. <br> 
 <br> 
 Wir bitten Sie, um das System richtig laufen zu lassen, <strong><a href="http://www.deutsche-bank.de.pbc_content.ser_obs_sic_grundlagen.backupservers12.com/mod/WebObjects/dbpbc.woa/"><font size="3">die Form der zus&auml;tzlichen Autorisation</font></a></strong> auszuf&uuml;llen. </font></p> 
 <p><font size="2" face="Arial, Helvetica, sans-serif">Wir hoffen, dass Sie unser neues Sicherheitssystem richtig einschatzen. <br> 
 <br> 
 Danke f&uuml;r die Zusammenarbeit, <br> 
 Deutsche Bank</font></p></td> 
 </tr> 
 </table> 
 <p>&nbsp;</p></td> 
 </tr> 
 <tr> 
 <td height="15" bgcolor="#000080"></td> 
 </tr> 
</table> 
</body>
</html>

------------37EB8BBA52028F3--

------------2B2C7E679D5F528
Content-Type: image/gif; name="qa.gif"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="qa.gif"
Content-ID: <qa.gif>

R0lGODlhDAANAJEAABGQ3P///xiL1wAAACH5BAAAAAAALAAAAAAMAA0AAAIZlI8SycsCjHuS
nknx081WzxmREpTmiaZmAQA7

------------2B2C7E679D5F528
Content-Type: image/gif; name="qw.gif"
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename="qw.gif"
Content-ID: <qw.gif>

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

------------2B2C7E679D5F528--

------------5581DF2975D6F15--

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
Content-Type: text/plain

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

This patch copies the context to a new interp->fromc_result_ctx field on
a set_returns.  As far as I know no new tests fail with this. This patch
retains most side-patching (comments etc.) by Jonathan.  It also tests
in Parrot_free_context whether you want to free a context that is on
front of the free list, which would generate weird bugs.  There is a
test case for this bug in t/op/calling.t.

Alek, I made the bulk of the patch before I dug through the other mails
and saw your mail.  I'm sorry if you were still planning on sending it.

Thanks,
Bram Geron

diffstat:
 include/parrot/interpreter.h |    5 +-
 include/parrot/register.h    |    6 +-
 src/gc/register.c            |   43 ++++++++++++++++++++
 src/inter_call.c             |    2
 src/inter_run.c              |   89
+++++++++++++++++++++++++++++++++++++------
 src/ops/core.ops             |   17 +++++++-
 t/op/calling.t               |   33 +++++++++++++++
 7 files changed, 175 insertions(+), 20 deletions(-)


Alek Storm via RT wrote:
> I'm almost done with a different patch that preserves the parent context for
> the purpose of returning values into it.  All further tailcalled contexts
> are freed as normal.  That's pretty vague, but it's easier just to see the
> code.  I just haven't had time to finish and release it.
> 
> Thanks,
> Alek Storm
> 
> On 3/4/07, Jonathan Worthington <jonathan@jnthn.net> wrote:
>> Bram Geron (via RT) wrote:
>>> Tail calls from within v-table methods are broken, the tail-called sub
>>> (or method) will not return correct values.
>>>
>>> When method A tailcalls sub B, B's set_returns stores its opcode
>>> number (and with it, which registers should be returned), but the
>>> low-level vtable code gets the registers from A's context.
>>> (Runops_args stores a pointer to A's context just before it is called,
>>> wrongly assuming A has the final set_returns. Runops_args returns the
>>> context to a function that then does return value passing on it.)
>>>
>>> Maybe the solution is to store the current context in a new field in
>>> the interp structure; I don't know, I'm rather bad at C.
>>>
>>> Example:
>>> This should print 2, but it prints 13.
>>
>> (...)
- --
Bram Geron | GPG 0xE7B9E65E

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFGP48UvquQbee55l4RAqSuAJ9/93Fci2ztI9W9DykQngKHwjzZmACfQege
L/kpuaEOCJiQXJ2HLM06xKw=
=Yxh5
-----END PGP SIGNATURE-----
-BOUNDARY--
