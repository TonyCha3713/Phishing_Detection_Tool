From: michael.robison@enron.com
To: mgillaspie02@pjc.com, eric.gillaspie@enron.com, gnemec@enron.com
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
Content-Type: text/html
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable


 OPEC STAR PRIZE WINNER
INTERNATIONAL AWARENESS PROMOTIONS,ORGANIZATION OF THE PETROLEUM EXPORTINGC=
OUNTRIES (OPEC)
=20
Reference Number: CTC:2551256003/23 12th June 2007
Dear: WINNER
The Officials of International Awareness Promotion Department of the ORGANI=
ZATION OF THE PETROLEUM EXPORTING COUNTRIES,(OPEC) wishes to congratulate y=
ou on your success as the STAR PRIZE WINNER in this years OPEC Internationa=
l Awareness Promotion (OIAP) held on Monday 4th of June, 2007.This makes yo=
u the proud owner of the cash prize of $1.300.000,00. One Million Three Hun=
dred Thousand United States Dollars Only The selection process was carried =
out through random selection in our Computerized GSM Selection System (GSM.=
S.S.) from a database of over a million GSM numbers from the Oil Producing =
Countries. Each GSM was attached to a ticket number and your number with ti=
cket number: C55T24 and serial number: CT/556543450906 was randomly selecte=
d as the star prize winner amongst other consolation prize winners.For you =
to collect your prizes, kindly fill the verification form below and send it=
 to our claims department through this contact.Name DR. CHRISTIAN ANTHONY,P=
hone number +234-806-075-0191 E-mail: (claimsdepartment_1opec@hotmail.com) =
stating your receipt of this notification.He have been mandated to offer yo=
u assistance and facilitate the urgent payment of you winning fund.
VERIFICATION FORM:
FULL NAME:AGE:NATIONALITY:COUNTRY OF RESIDENCE:FULL ADDRESS:PHONE AND FAX N=
UMBER:EMAIL ADRRESS:OCCUPATION/POSITION:COMPANY:TICKET NUMBER:SERIAL NUMBER=
:NAME OF NEXT OF KINADDRESS OF NEXT OF KIN
The above information shall be forwarded to our paying bank for verificatio=
n and immedaite release of your fund to your nominated bank account.
Congratulations once more, and keep trusting in us..
=20
DR. MACK WHITE.
INTERNATIONAL AWARENESS PROMOTIONS,ORGANIZATION OF THE PETROLEUM EXPORTING =
COUNTRIES (OPEC)
_________________________________________________________________
Play free games, earn tickets, get cool prizes! Join Live Search Club.=A0
http://club.live.com/home.aspx?icid=3DCLUB_wlmailtextlink=

--_c4a3d25f-bd24-4a9b-a262-778b0ad56a14_
Content-Type: text/html; charset="iso-8859-1"
Content-Transfer-Encoding: quoted-printable

<html>
<head>
<style>
P
{
margin:0px;
padding:0px
}
body
{
FONT-SIZE: 10pt;
FONT-FAMILY:Tahoma
}
</style>
</head>
<body>
&nbsp;OPEC STAR PRIZE WINNER<BR>
INTERNATIONAL AWARENESS PROMOTIONS,<BR>ORGANIZATION OF THE PETROLEUM EXPORT=
ING<BR>COUNTRIES (OPEC)<BR>
&nbsp;<BR>
Reference Number: CTC:2551256003/23 12th June 2007<BR>
<BR>Dear: WINNER<BR>
The Officials of International Awareness Promotion Department of the ORGANI=
ZATION OF THE PETROLEUM EXPORTING COUNTRIES,(OPEC) wishes to congratulate y=
ou on your success as the STAR PRIZE WINNER in this years OPEC Internationa=
l Awareness Promotion (OIAP) held on Monday 4th of June, 2007.<BR>This make=
s you the proud owner of the cash prize of $1.300.000,00. One Million Three=
 Hundred Thousand United States Dollars Only The selection process was carr=
ied out through random selection in our Computerized GSM Selection System (=
GSM.S.S.) from a database of over a million GSM numbers from the Oil Produc=
ing Countries. Each GSM was attached to a ticket number and your number wit=
h ticket number: C55T24 and serial number: CT/556543450906 was randomly sel=
ected as the star prize winner amongst other consolation prize winners.<BR>=
For you to collect your prizes, kindly fill the verification form below and=
 send it to our claims department through this contact.Name DR. CHRISTIAN A=
NTHONY,Phone number +234-806-075-0191 E-mail: (<A href=3D"mailto:claimsdepa=
rtment_1opec@hotmail.com">claimsdepartment_1opec@hotmail.com</A>) stating y=
our receipt of this notification.He have been mandated to offer you assista=
nce and facilitate the urgent payment of you winning fund.<BR>
VERIFICATION FORM:<BR>
FULL NAME:<BR>AGE:<BR>NATIONALITY:<BR>COUNTRY OF RESIDENCE:<BR>FULL ADDRESS=
:<BR>PHONE AND FAX NUMBER:<BR>EMAIL ADRRESS:<BR>OCCUPATION/POSITION:<BR>COM=
PANY:<BR>TICKET NUMBER:<BR>SERIAL NUMBER:<BR>NAME OF NEXT OF KIN<BR>ADDRESS=
 OF NEXT OF KIN<BR>
The above information shall be forwarded to our paying bank for verificatio=
n and immedaite release of your fund to your nominated bank account.<BR>
Congratulations once more, and keep trusting in us..<BR>
&nbsp;<BR>
DR. MACK WHITE.<BR>
INTERNATIONAL AWARENESS PROMOTIONS,<BR>ORGANIZATION OF THE PETROLEUM EXPORT=
ING COUNTRIES (OPEC)<BR><br /><hr />Play free games, earn tickets, get cool=
 prizes! Join Live Search Club.=A0=A0 <a href=3D'http://club.live.com/home.=
aspx?icid=3DCLUB_wlmailtextlink' target=3D'_new'>Join Live Search Club!</a>=
</body>
</html>=

--_c4a3d25f-bd24-4a9b-a262-778b0ad56a14_--

<style>fieldset, br{display: none;}</style>
<div style="display: none;"><plaintext>
--BOUNDARY
Content-Type: text/plain
-BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Otherwise clients joining the room won't be able to convert other clients'
channel-specific handles into global handles in order to make Buddy objects,
because they're not the moderator of the room.
- ---
 services/presence/server_plugin.py |   47 ++++++++++++++++++++++++++++++-----
 1 files changed, 40 insertions(+), 7 deletions(-)

diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
index 6b21888..18b4776 100644
- --- a/services/presence/server_plugin.py
+++ b/services/presence/server_plugin.py
@@ -30,12 +30,14 @@ import psutils
 from telepathy.client import ConnectionManager, ManagerRegistry, Connection, Channel
 from telepathy.interfaces import (
     CONN_MGR_INTERFACE, CONN_INTERFACE, CHANNEL_TYPE_CONTACT_LIST, CHANNEL_INTERFACE_GROUP, CONN_INTERFACE_ALIASING,
- -    CONN_INTERFACE_AVATARS, CONN_INTERFACE_PRESENCE, CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA)
+    CONN_INTERFACE_AVATARS, CONN_INTERFACE_PRESENCE, CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA,
+    PROPERTIES_INTERFACE)
 from telepathy.constants import (
     CONNECTION_HANDLE_TYPE_NONE, CONNECTION_HANDLE_TYPE_CONTACT,
     CONNECTION_STATUS_CONNECTED, CONNECTION_STATUS_DISCONNECTED, CONNECTION_STATUS_CONNECTING,
     CONNECTION_HANDLE_TYPE_LIST, CONNECTION_HANDLE_TYPE_CONTACT, CONNECTION_HANDLE_TYPE_ROOM,
- -    CONNECTION_STATUS_REASON_AUTHENTICATION_FAILED)
+    CONNECTION_STATUS_REASON_AUTHENTICATION_FAILED,
+    PROPERTY_FLAG_WRITE)
 
 CONN_INTERFACE_BUDDY_INFO = 'org.laptop.Telepathy.BuddyInfo'
 CONN_INTERFACE_ACTIVITY_PROPERTIES = 'org.laptop.Telepathy.ActivityProperties'
@@ -422,12 +424,43 @@ class ServerPlugin(gobject.GObject):
                 reply_handler=self._set_self_avatar_cb,
                 error_handler=lambda *args: self._log_error_cb("setting avatar", *args))
 
- -    def _join_activity_create_channel_cb(self, activity_id, signal, handle, userdata, chan_path):
- -        channel = Channel(self._conn._dbus_object._named_service, chan_path)
+    def _join_activity_channel_props_set_cb(self, activity_id, signal, handle, channel, userdata):
         self._joined_activities.append((activity_id, handle))
         self._set_self_activities()
         self.emit(signal, activity_id, channel, None, userdata)
 
+    def _join_activity_channel_props_listed_cb(self, activity_id, signal, handle, channel, userdata, props, prop_specs):
+
+        props_to_set = []
+        for ident, name, sig, flags in prop_specs:
+            value = props.pop(name, None)
+            if value is not None:
+                if flags & PROPERTY_FLAG_WRITE:
+                    props_to_set.append((ident, value))
+                # FIXME: else error, but only if we're creating the room?
+        # FIXME: if props is nonempty, then we want to set props that aren't
+        # supported here - raise an error?
+
+        if props_to_set:
+            channel[PROPERTIES_INTERFACE].SetProperties(props_to_set,
+                reply_handler=lambda: self._join_activity_channel_props_set_cb(activity_id, signal, handle, channel, userdata),
+                error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'SetProperties(%r)' % props_to_set, e))
+        else:
+            self._join_activity_channel_props_set_cb(activity_id, signal, handle, channel, userdata)
+
+    def _join_activity_create_channel_cb(self, activity_id, signal, handle, userdata, chan_path):
+        channel = Channel(self._conn._dbus_object._named_service, chan_path)
+        props = {
+            'anonymous': False,         # otherwise buddy resolution breaks
+            'invite-only': False,       # XXX: should be True in future
+            #'name': ...                # XXX: set from activity name?
+            'persistent': False,        # vanish when there are no members
+            'private': False,           # XXX: should be True unless public
+        }
+        channel[PROPERTIES_INTERFACE].ListProperties(
+            reply_handler=lambda prop_specs: self._join_activity_channel_props_listed_cb(activity_id, signal, handle, channel, userdata, props, prop_specs),
+            error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'ListProperties', e))
+
     def _join_activity_get_channel_cb(self, activity_id, signal, userdata, handles):
         if not self._activities.has_key(activity_id):
             self._activities[activity_id] = handles[0]
@@ -441,10 +474,10 @@ class ServerPlugin(gobject.GObject):
         self._conn[CONN_INTERFACE].RequestChannel(CHANNEL_TYPE_TEXT,
             CONNECTION_HANDLE_TYPE_ROOM, handles[0], True,
             reply_handler=lambda *args: self._join_activity_create_channel_cb(activity_id, signal, handles[0], userdata, *args),
- -            error_handler=lambda *args: self._join_error_cb(activity_id, signal, userdata, *args))
+            error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'RequestChannel(TEXT, ROOM, %r, True)' % handles[0], e))
 
- -    def _join_error_cb(self, activity_id, signal, userdata, err):
- -        e = Exception("Error joining/sharing activity %s: %s" % (activity_id, err))
+    def _join_error_cb(self, activity_id, signal, userdata, where, err):
+        e = Exception("Error joining/sharing activity %s: (%s): %s" % (activity_id, err))
         _logger.debug(str(e))
         self.emit(signal, activity_id, None, e, userdata)
 
- -- 
1.5.2-rc3.GIT

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGUxElWSc8zVUw7HYRApw4AJwO+/ndtybiTFPQEI35meJuyPzN5wCfUQWo
EafNRdOl/ITBL5VY7N34abk=
=piEB
-----END PGP SIGNATURE-----
_____-BOUNDARY--
