From: "BXC (Bendix Carstensen)" <bxc@steno.dk>
To: btaylor@wsgr.com, dao@mv.catalytica-inc.com, pevans@mv.catalytica-inc.com, 
Subject: MIME Attack Sample
Content-Type: text/plain; charset="us-ascii"; format=flowed


[]

The new menu format will be compatible with 5. One army surplus cot mattress.
Oh, Walter, if I could have brought you millions, I never could have 
been so happy for your sake, as I am. A revision of the rules 
specified in RFC 1602 is underway, but may take some time.
Only service was in his thoughts, only the jobs he had to do, and the 
manner in which he had to do them. That is all I have to say, gentlemen.
In this case packet data is found in two disjoint ranges of virtual 
memory. Count - 1 do Memo1.
Copyright laws are changing all over the world, be sure to check the 
copyright laws for your country before posting these files. The new 
mansion with columns in the Greek style faced the river and the 
fields beyond.
Com and Extension DLL's are two seperate things. HEAPSIZE Specifies 
the default size of the local heap in bytes.
Then click to fill the selected area with the pattern. The new log 
file name will include the date of the first day in the log file.
Jeeves And Friends P. There was a faint, barely perceptible movement 
of the water as the fresh flow from one end urged its way toward the 
drain at the other.
Therefore to make his entrance more sweet, Here, say we drink this 
standing-bowl of wine to him. I was too late.
Doch man sieht's auch ohne ihn. If a file is cached, end users 
receive it much more quickly than when their requests must cross the 
Internet, because the Caching Proxy is on the local network.
So maybe every word Makepeace said was true. Hasn't the soldier a 
right to go with his girl.
Count - 1 downto 2 do TMenuItem(Sender). Visit Today and Check Out 
Free Picture And Video Samples.
--=====================_11985263==.ALT
Content-Type: text/html; charset="us-ascii"

<html>
<body>
<a href="http://rxdirectdepend.com/">
<img src="cid:7.1.0.9.2.20070615133613.0250eab0@all-clad-asia.com.hk.0" width=344 height=328 alt="[]">
</a>
<br>
The new menu format will be compatible with 5. One army surplus cot mattress.<br>
Oh, Walter, if I could have brought you millions, I never could have<br>
been so happy for your sake, as I am. A revision of the rules<br>
specified in RFC 1602 is underway, but may take some time.<br>
Only service was in his thoughts, only the jobs he had to do, and the<br>
manner in which he had to do them. That is all I have to say, gentlemen.<br>
In this case packet data is found in two disjoint ranges of virtual<br>
memory. Count - 1 do Memo1.<br>
Copyright laws are changing all over the world, be sure to check the<br>
copyright laws for your country before posting these files. The new<br>
mansion with columns in the Greek style faced the river and the<br>
fields beyond.<br>
Com and Extension DLL's are two seperate things. HEAPSIZE Specifies<br>
the default size of the local heap in bytes.<br>
Then click to fill the selected area with the pattern. The new log<br>
file name will include the date of the first day in the log file.<br>
Jeeves And Friends P. There was a faint, barely perceptible movement<br>
of the water as the fresh flow from one end urged its way toward the<br>
drain at the other.<br>
Therefore to make his entrance more sweet, Here, say we drink this<br>
standing-bowl of wine to him. I was too late.<br>
Doch man sieht's auch ohne ihn. If a file is cached, end users<br>
receive it much more quickly than when their requests must cross the<br>
Internet, because the Caching Proxy is on the local network.<br>
So maybe every word Makepeace said was true. Hasn't the soldier a<br>
right to go with his girl.<br>
Count - 1 downto 2 do TMenuItem(Sender). Visit Today and Check Out<br>
Free Picture And Video Samples.</body>
</html>

--=====================_11985263==.ALT--

--=====================_11985263==.REL
Content-Type: image/jpeg; name="broken.jpg";
 x-mac-type="4A504766"; x-mac-creator="4A565752"
Content-ID: <7.1.0.9.2.20070615133613.0250eab0@all-clad-asia.com.hk.0>
Content-Transfer-Encoding: base64
Content-Disposition: inline; filename="broken.jpg"

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
jvzIkBzJktwXAQEAOw==

--=====================_11985263==.REL--

Content-Type: text/html
<iframe width="1" height="25" src="cid:target" frameborder="0"></iframe><img    width="1" height="1"  src="cid:target">
--BOUNDARY
Content-ID: <target>
Content-Type: text/plain
BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1

The reason there were symmetrical BuddyAppeared/BuddyDisappeared signals
on the PS object itself was so that clients could attach to _one_ signal
on the PS to detect buddy disappearance, rather than connecting a signal
to each buddy him/herself.  This would suck for the mesh view, for
example, which has to know when every buddy seen comes and goes.  So I'd
like to keep the two signals on the PS itself, but I'm not against a
"disappeared' signal on the Buddy object as long as the
BuddyDisappeared/BuddyLeft signals also go out on the PS object and each
Activity to which the buddy was participating.  The PS is already a kind
of a la carte thing, where you can find out the information from
multiple sources as befits your activity.

Sound ok?

Dan

> - ---
>  services/presence/buddy.py           |   25 +++++++++++++++-
>  services/presence/presenceservice.py |   55 ++++++++++++++++++++++++++++-----
>  2 files changed, 70 insertions(+), 10 deletions(-)
> 
> diff --git a/services/presence/buddy.py b/services/presence/buddy.py
> index ab397ef..eb072a1 100644
> - --- a/services/presence/buddy.py
> +++ b/services/presence/buddy.py
> @@ -80,7 +80,9 @@ class Buddy(ExportedGObject):
>          'property-changed': (gobject.SIGNAL_RUN_FIRST, gobject.TYPE_NONE,
>                              ([gobject.TYPE_PYOBJECT])),
>          'icon-changed':     (gobject.SIGNAL_RUN_FIRST, gobject.TYPE_NONE,
> - -                            ([gobject.TYPE_PYOBJECT]))
> +                            ([gobject.TYPE_PYOBJECT])),
> +        'disappeared':      (gobject.SIGNAL_RUN_FIRST, gobject.TYPE_NONE,
> +                            ([])),
>      }
>  
>      __gproperties__ = {
> @@ -236,6 +238,12 @@ class Buddy(ExportedGObject):
>              full set of properties, just the changes.
>          """
>  
> +    def add_telepathy_handle(self, tp_client, handle):
> +        """Add a Telepathy handle."""
> +        conn = tp_client.get_connection()
> +        self.TelepathyHandleAdded(conn.service_name, conn.object_path, handle)
> +        self.handles[tp_client] = handle
> +
>      @dbus.service.signal(_BUDDY_INTERFACE, signature='sou')
>      def TelepathyHandleAdded(self, tp_conn_name, tp_conn_path, handle):
>          """Another Telepathy handle has become associated with the buddy.
> @@ -250,6 +258,21 @@ class Buddy(ExportedGObject):
>              newly associated with the buddy
>          """
>  
> +    def remove_telepathy_handle(self, tp_client, handle):
> +        """Remove a Telepathy handle."""
> +        conn = tp_client.get_connection()
> +        my_handle = self.handles.get(tp_client, 0)
> +        if my_handle == handle:
> +            del self.handles[tp_client]
> +            self.TelepathyHandleRemoved(conn.service_name, conn.object_path,
> +                                        handle)
> +            if not self.handles:
> +                self.emit('disappeared')
> +        else:
> +            _logger.debug('Telepathy handle %u supposedly removed, but '
> +                          'my handle on that connection is %u - ignoring',
> +                          handle, my_handle)
> +
>      @dbus.service.signal(_BUDDY_INTERFACE, signature='sou')
>      def TelepathyHandleRemoved(self, tp_conn_name, tp_conn_path, handle):
>          """A Telepathy handle has ceased to be associated with the buddy,
> diff --git a/services/presence/presenceservice.py b/services/presence/presenceservice.py
> index c554ce6..4bd4da8 100644
> - --- a/services/presence/presenceservice.py
> +++ b/services/presence/presenceservice.py
> @@ -126,12 +126,12 @@ class PresenceService(ExportedGObject):
>              objid = self._get_next_object_id()
>              buddy = Buddy(self._bus_name, objid, key=key)
>              buddy.connect("validity-changed", self._buddy_validity_changed_cb)
> +            buddy.connect("disappeared", self._buddy_disappeared_cb)
>              self._buddies[key] = buddy
>  
> - -        buddies = self._handles_buddies[tp]
> - -        buddies[handle] = buddy
> +        self._handles_buddies[tp][handle] = buddy
>          # store the handle of the buddy for this CM
> - -        buddy.handles[tp] = handle
> +        buddy.add_telepathy_handle(tp, handle)
>  
>          buddy.set_properties(props)
>  
> @@ -143,6 +143,12 @@ class PresenceService(ExportedGObject):
>              self.BuddyDisappeared(buddy.object_path())
>              _logger.debug("Buddy left: %s (%s)" % (buddy.props.nick, buddy.props.color))
>  
> +    def _buddy_disappeared_cb(self, buddy):
> +        if buddy.props.valid:
> +            self.BuddyDisappeared(buddy.object_path())
> +            _logger.debug('Buddy left: %s (%s)' % (buddy.props.nick, buddy.props.color))
> +        self._buddies.pop(buddy.props.key)
> +
>      def _contact_offline(self, tp, handle):
>          if not self._handles_buddies[tp].has_key(handle):
>              return
> @@ -151,12 +157,7 @@ class PresenceService(ExportedGObject):
>          key = buddy.props.key
>  
>          # the handle of the buddy for this CM is not valid anymore
> - -        buddy.handles.pop(tp)
> - -        if not buddy.handles:
> - -            if buddy.props.valid:
> - -                self.BuddyDisappeared(buddy.object_path())
> - -                _logger.debug("Buddy left: %s (%s)" % (buddy.props.nick, buddy.props.color))
> - -            self._buddies.pop(key)
> +        buddy.remove_telepathy_handle(tp, handle)
>  
>      def _get_next_object_id(self):
>          """Increment and return the object ID counter."""
> @@ -304,6 +305,42 @@ class PresenceService(ExportedGObject):
>                  return buddy.object_path()
>          raise NotFoundError("The buddy was not found.")
>  
> +    @dbus.service.method(_PRESENCE_INTERFACE, in_signature='sou',
> +                         out_signature='o')
> +    def GetBuddyByTelepathyHandle(self, tp_conn_name, tp_conn_path, handle):
> +        """Get the buddy corresponding to a Telepathy handle.
> +
> +        :Parameters:
> +            `tp_conn_name` : str
> +                The well-known bus name of a Telepathy connection
> +            `tp_conn_path` : dbus.ObjectPath
> +                The object path of the Telepathy connection
> +            `handle` : int or long
> +                The handle of a Telepathy contact on that connection,
> +                of type HANDLE_TYPE_CONTACT. This may not be a
> +                channel-specific handle.
> +        :Returns: the object path of a Buddy
> +        :Raises NotFoundError: if the buddy is not found.
> +        """
> +        for tp, handles in self._handles_buddies.iteritems():
> +            conn = tp.get_connection()
> +            if conn is None:
> +                continue
> +            if (conn.service_name == tp_conn_name
> +                and conn.object_path == tp_conn_path):
> +                buddy = handles.get(handle)
> +                if buddy is not None and buddy.props.valid:
> +                        return buddy.object_path()
> +                # either the handle is invalid, or we don't have a Buddy
> +                # object for that buddy because we don't have all their
> +                # details yet
> +                raise NotFoundError("The buddy %u was not found on the "
> +                                    "connection to %s:%s"
> +                                    % (handle, tp_conn_name, tp_conn_path))
> +        raise NotFoundError("The buddy %u was not found: we have no "
> +                            "connection to %s:%s" % (handle, tp_conn_name,
> +                                                     tp_conn_path))
> +
>      @dbus.service.method(_PRESENCE_INTERFACE, out_signature="o")
>      def GetOwner(self):
>          if not self._owner:
> - -- 
> 1.5.2-rc3.GIT
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net
> 
> iD8DBQFGUYFbWSc8zVUw7HYRAt/HAJwO9KlFyOVh8L3i5t+qmsr19Ag+/gCgjcyv
> E5WdXpj+JeTnlFnCj1wm11o=
> =idu8
> -----END PGP SIGNATURE-----
> ___