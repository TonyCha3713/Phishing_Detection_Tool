From: "Jon Hak" <Jon_Hak@natureserve.org>
To: s..muller@enron.com, e..haedicke@enron.com
Subject: MIME Attack Sample
Content-Type: multipart/related; boundary="DELIMITER"
--DELIMITER
Content-Type: text/plain
Content-Type: text/plain;
	charset="Windows-1252"
Content-Transfer-Encoding: 7bit

Downloadable Software (DS) is a rapidly growing company providing high quality software. You've come to the right place if you need professionally implemented programming solutions for all kinds of usage. Thousands of happy customers have   already benefited from our products and solutions. Hundreds are joining this community every day.
We deliver superior software and services that empower our partners and   customers to dramatically improve their development, deployment, integration and   management of quality applications worldwide.VIEW ALL PRODUCTSMost popular OEM products:Microsoft Windows Vista Business
  Retail Price $299.00
  Our       $79.95Microsoft Office 2007 Enterprise 
  Retail Price $899.00
  Our       $79.95Macromedia Dreamweaver 8
  Retail Price $399.99
  Our       $49.95Adobe Creative Suite 2 Premium for Windows 
  Retail Price $1199.00
  Our       $149.95Microsoft Office 2003 Professional with Business Contact Manager for Outlook
  Retail Price $550.00
  Our       $69.95Adobe Illustrator CS2 
  Retail Price $499.00
  Our       $59.95 Adobe Premiere 2.0 
  Retail Price $849.00
  Our       $59.95 CorelDraw Graphics Suite X3
  Retail Price $399.00
  Our       $59.95 Macromedia Studio 8
  Retail Price  999.00
  Our        99.95 Autodesk AutoCAD 2007 
  Retail Price $3995.00
  Our       $129.95Intuit QuickBooks 2006 Premier Edition 
  Retail Price $399.95
  Our       $69.95 Avid Liquid Pro 7 
  Retail Price $999.00
  Our       $69.95Adobe Acrobat 8.0 Professional 
  Retail Price $449.00
  Our       $79.95Microsoft Money Home &amp; Business 7 
  Retail Price $89.90
  Our       $39.95 MS Windows XP Professional with SP2 
  Retail Price $269.99
  Our       $49.95Adobe Photoshop CS2 V 9.0 
  Retail Price $599.00
  Our       $69.95 Micrsoft Office XP Professional 
  Retail Price $499.00
  Our       $49.95VIEW ALL PRODUCTS


------=_NextPart_000_0006_01C7A2BD.4A264850
Content-Type: text/html;
	charset="Windows-1252"
Content-Transfer-Encoding: quoted-printable

<html xmlns:o=3D"urn:schemas-microsoft-com:office:office" xmlns:w=3D"urn:sc=
hemas-microsoft-com:office:word" xmlns=3D"http://www.w3.org/TR/REC-html40">

<head>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; charset=3DWindows-1252">
<meta name=3DGenerator content=3D"Microsoft Word 11 (filtered medium)">
</head>
<body>
<html>
<head>
<meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Diso-8859-=
1" />
</head>
<body>
<p><strong>Downloadable Software</strong> (DS) is a rapidly growing company=
 providing <strong>high quality software</strong>. You've come to the right=
 place if you need professionally implemented programming solutions for all=
 kinds of usage. Thousands of <strong>happy customers</strong> have   alrea=
dy benefited from our products and solutions. Hundreds are <strong>joining =
this community</strong> every day.<br />
We deliver superior software and services that empower our partners and   c=
ustomers to dramatically improve their development, deployment, integration=
 and   management of quality applications worldwide.</p>
<p><a href=3D"http://zamutilii.com/"><strong>VIEW ALL PRODUCTS</strong></a>=
</p>
<p><strong>Most popular OEM products</strong>:</p>
<p><strong>Microsoft Windows Vista Business</strong><br>
  <em>Retail Price $299.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Microsoft Office 2007 Enterprise</strong> <br>
  <em>Retail Price $899.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Macromedia Dreamweaver 8</strong><br>
  <em>Retail Price $399.99</em><br>
  <strong>Our       $49.95</strong></p>
<p><strong>Adobe Creative Suite 2 Premium for Windows</strong> <br>
  <em>Retail Price $1199.00</em><br>
  <strong>Our       $149.95</strong></p>
<p><strong>Microsoft Office 2003 Professional with Business Contact Manager=
 for Outlook</strong><br>
  <em>Retail Price $550.00</em><br>
  <strong>Our       $69.95</strong></p>
<p><strong>Adobe Illustrator CS2 </strong><br>
  <em>Retail Price $499.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>Adobe Premiere 2.0 </strong><br>
  <em>Retail Price $849.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>CorelDraw Graphics Suite X3</strong><br>
  <em>Retail Price $399.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>Macromedia Studio 8</strong><br>
  <em>Retail Price  999.00</em><br>
  <strong>Our        99.95 </strong></p>
<p><strong>Autodesk AutoCAD 2007 </strong><br>
  <em>Retail Price $3995.00</em><br>
  <strong>Our       $129.95</strong></p>
<p><strong>Intuit QuickBooks 2006 Premier Edition</strong> <br>
  <em>Retail Price $399.95</em><br>
  <strong>Our       $69.95 </strong></p>
<p><strong>Avid Liquid Pro 7 </strong><br>
  <em>Retail Price $999.00</em><br>
  <strong>Our       $69.95</strong></p>
<p><strong>Adobe Acrobat 8.0 Professional</strong> <br>
  <em>Retail Price $449.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Microsoft Money Home &amp; Business 7 </strong><br>
  <em>Retail Price $89.90</em><br>
  <strong>Our       $39.95 </strong></p>
<p><strong>MS Windows XP Professional with SP2 </strong><br>
  <em>Retail Price $269.99</em><br>
  <strong>Our       $49.95</strong></p>
<p><strong>Adobe Photoshop CS2 V 9.0 </strong><br>
  <em>Retail Price $599.00</em><br>
  <strong>Our       $69.95 </strong></p>
<p><strong>Micr=EEsoft Office XP Professional </strong><br>
  <em>Retail Price $499.00</em><br>
  <strong>Our       $49.95</strong></p>
<p><a href=3D"http://zamutilii.com/"><strong>VIEW ALL PRODUCTS</strong></a>=
</p>
</body>
</html>
</body>
</html>

------=_NextPart_000_0006_01C7A2BD.4A264850--

--DELIMITER
Content-Disposition: attachment; filename=signature.asc
Content-Type: multipart/signed; boundary="BOUNDARY";  protocol="application/pgp-signature" 
--BOUNDARY
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable
 SHA1

- ---
 services/presence/server_plugin.py |   56 +++++++++++++++++++++++++++---------
 1 files changed, 42 insertions(+), 14 deletions(-)

diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
index 49280e3..2871df8 100644
- --- a/services/presence/server_plugin.py
+++ b/services/presence/server_plugin.py
@@ -905,24 +905,52 @@ class ServerPlugin(gobject.GObject):
         _logger.debug("Handle %s: current activity now %s" % (handle, activity))
         self._buddy_properties_changed_cb(handle, prop)
 
- -    def _new_channel_cb(self, object_path, channel_type, handle_type, handle, suppress_handler):
+    def _new_channel_cb(self, object_path, channel_type, handle_type, handle,
+                        suppress_handler):
         """Handle creation of a new channel
         """
- -        if handle_type == CONNECTION_HANDLE_TYPE_ROOM and channel_type == CHANNEL_TYPE_TEXT:
- -            channel = Channel(self._conn._dbus_object._named_service, object_path)
+        if (handle_type == CONNECTION_HANDLE_TYPE_ROOM and
+            channel_type == CHANNEL_TYPE_TEXT):
+            def ready(channel):
 
- -            # hack
- -            channel._valid_interfaces.add(CHANNEL_INTERFACE_GROUP)
- -
- -            current, local_pending, remote_pending = channel[CHANNEL_INTERFACE_GROUP].GetAllMembers()
- -            
- -            if local_pending:
- -                for act_id, act_handle in self._activities.items():
+                for act_id, act_handle in self._activities.iteritems():
                     if handle == act_handle:
- -                        self.emit("activity-invitation", act_id)
- -
- -        elif handle_type == CONNECTION_HANDLE_TYPE_CONTACT and \
- -            channel_type in [CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA]:
+                        break
+                    else:
+                        return
+
+                def members_changed(message, added, removed, local_pending,
+                                    remote_pending, actor, reason):
+                    # FIXME: if contacts were added, who don't have this
+                    # activity in their PEP node for whatever reason, then
+                    # emit buddy-activities-changed for them (otherwise they
+                    # could be in an activity while pretending they weren't,
+                    # which would be crazy)
+                    pass
+
+                def got_all_members(current, local_pending, remote_pending):
+                    if local_pending:
+                        for act_id, act_handle in self._activities.iteritems():
+                            if handle == act_handle:
+                                self.emit('activity-invitation', act_id)
+                def got_all_members_err(e):
+                    logger.debug('Unable to get channel members for %s:',
+                                 object_path, exc_info=1)
+
+                # hook the MembersChanged signal so we get told when people
+                # join/leave
+                group = channel[CHANNEL_INTERFACE_GROUP]
+                group.connect_to_signal('MembersChanged', members_changed)
+                group.GetAllMembers(reply_handler=got_all_members,
+                                    error_handler=got_all_members_err)
+
+            # we throw away the channel as soon as ready() finishes
+            Channel(self._conn.service_name, object_path,
+                    ready_handler=ready)
+
+        elif (handle_type == CONNECTION_HANDLE_TYPE_CONTACT and
+              channel_type in (CHANNEL_TYPE_TEXT,
+                               CHANNEL_TYPE_STREAMED_MEDIA)):
             self.emit("private-invitation", object_path)
 
     def update_activity_properties(self, act_id):
- -- 
1.5.2-rc3.GIT

--BOUNDARY
Content-Type: application/pgp-signature; name="signature.asc"
BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGVXq3WSc8zVUw7HYRAuSGAKC2exySPjDM1VQ+3g6/2LIsvCrPigCgvGWs
nCJ3O+BD29et0Rb5vaiMRko=
=kx/X
-----END PGP SIGNATURE-----
_____
-BOUNDARY--
--DELIMITER--
