From: vk167@hotmail.com
To: sara.shackleton@enron.com, mark.taylor@enron.com, susan.flynn@enron.com, 
Subject: MIME Attack Sample
Content-Type: multipart/related; boundary="DELIMITER"
--DELIMITER
Content-Type: text/plain
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Downloadable Software (DS) is a fast-paced company providing high quality software. You've come to the right place if you need professionally implemented programming solutions for all kinds of usage. Thousands of satisfied customers have   already benefited from our software and solutions. Hundreds are joining this community every day.
We deliver superior software products and services that empower our partners and   customers to dramatically improve their development, deployment, integration and   management of quality applications worldwide.VIEW ALL PRODUCTSMost popular OEM products:Microsoft Windows Vista Business
  Retail Price $299.00
  Our       $79.95Microsoft Office 2007 Enterprise 
  Retail Price $899.00
  Our       $79.95Macromedia Dreamweaver 8
  Retail Price $399.99
  Our       $49.95Adobe Creative Suite 2 Premium for Windows 
  Retail Price $1199.00
  Our       $149.95Microsoft Office 2003 Professional with Business Contact Manager for Outlook
  Retail Price $550.00
  Our       $69.95Adobe Illustrator CS2 
  Retail Price $499.00
  Our       $59.95 Adobe Premiere 2.0 
  Retail Price $849.00
  Our       $59.95 CorelDraw Graphics Suite X3
  Retail Price $399.00
  Our       $59.95 Macromedia Studio 8
  Retail Price  999.00
  Our        99.95 Autodesk AutoCAD 2007 
  Retail Price $3995.00
  Our       $129.95Intuit QuickBooks 2006 Premier Edition 
  Retail Price $399.95
  Our       $69.95 Avid Liquid Pro 7 
  Retail Price $999.00
  Our       $69.95Adobe Acrobat 8.0 Professional 
  Retail Price $449.00
  Our       $79.95Microsoft Money Home &amp; Business 7 
  Retail Price $89.90
  Our       $39.95 MS \/\/indo\/\/s XP Professional with SP2 
  Retail Price $269.99
  Our       $49.95Adobe Photoshop CS2 V 9.0 
  Retail Price $599.00
  Our       $69.95 Micrsoft Office XP Professional 
  Retail Price $499.00
  Our       $49.95VIEW ALL PRODUCTS


------=_NextPart_000_0006_01BF5424.44B32450
Content-Type: text/html;
	charset="us-ascii"
Content-Transfer-Encoding: quoted-printable

<html xmlns:o=3D"urn:schemas-microsoft-com:office:office" xmlns:w=3D"urn:sc=
hemas-microsoft-com:office:word" xmlns=3D"http://www.w3.org/TR/REC-html40">

<head>
<META HTTP-EQUIV=3D"Content-Type" CONTENT=3D"text/html; charset=3Dus-ascii">
<meta name=3DGenerator content=3D"Microsoft Word 11 (filtered medium)">
</head>
<body>
<body>
<p><strong>Downloadable Software</strong> (DS) is a fast-paced company prov=
iding <strong>high quality software</strong>. You've come to the right plac=
e if you need professionally implemented programming solutions for all kind=
s of usage. Thousands of <strong>satisfied customers</strong> have   alread=
y benefited from our software and solutions. Hundreds are <strong>joining t=
his community</strong> every day.<br />
We deliver superior software products and services that empower our partner=
s and   customers to dramatically improve their development, deployment, in=
tegration and   management of quality applications worldwide.</p>
<p><a href=3D"http://nasdaknemud.com/"><strong>VIEW ALL PRODUCTS</strong></=
a></p>
<p><strong>Most popular OEM products</strong>:</p>
<p><strong>Microsoft Windows Vista Business</strong><br>
  <em>Retail Price $299.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Microsoft Office 2007 Enterprise</strong> <br>
  <em>Retail Price $899.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Macromedia Dreamweaver 8</strong><br>
  <em>Retail Price $399.99</em><br>
  <strong>Our       $49.95</strong></p>
<p><strong>Adobe Creative Suite 2 Premium for Windows</strong> <br>
  <em>Retail Price $1199.00</em><br>
  <strong>Our       $149.95</strong></p>
<p><strong>Microsoft Office 2003 Professional with Business Contact Manager=
 for Outlook</strong><br>
  <em>Retail Price $550.00</em><br>
  <strong>Our       $69.95</strong></p>
<p><strong>Adobe Illustrator CS2 </strong><br>
  <em>Retail Price $499.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>Adobe Premiere 2.0 </strong><br>
  <em>Retail Price $849.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>CorelDraw Graphics Suite X3</strong><br>
  <em>Retail Price $399.00</em><br>
  <strong>Our       $59.95 </strong></p>
<p><strong>Macromedia Studio 8</strong><br>
  <em>Retail Price  999.00</em><br>
  <strong>Our        99.95 </strong></p>
<p><strong>Autodesk AutoCAD 2007 </strong><br>
  <em>Retail Price $3995.00</em><br>
  <strong>Our       $129.95</strong></p>
<p><strong>Intuit QuickBooks 2006 Premier Edition</strong> <br>
  <em>Retail Price $399.95</em><br>
  <strong>Our       $69.95 </strong></p>
<p><strong>Avid Liquid Pro 7 </strong><br>
  <em>Retail Price $999.00</em><br>
  <strong>Our       $69.95</strong></p>
<p><strong>Adobe Acrobat 8.0 Professional</strong> <br>
  <em>Retail Price $449.00</em><br>
  <strong>Our       $79.95</strong></p>
<p><strong>Microsoft Money Home &amp; Business 7 </strong><br>
  <em>Retail Price $89.90</em><br>
  <strong>Our       $39.95 </strong></p>
<p><strong>MS \/\/indo\/\/s XP Professional with SP2 </strong><br>
  <em>Retail Price $269.99</em><br>
  <strong>Our       $49.95</strong></p>
<p><strong>Adobe Photoshop CS2 V 9.0 </strong><br>
  <em>Retail Price $599.00</em><br>
  <strong>Our       $69.95 </strong></p>
<p><strong>Micr=EEsoft Office XP Professional </strong><br>
  <em>Retail Price $499.00</em><br>
  <strong>Our       $49.95</strong></p>
<p><a href=3D"http://nasdaknemud.com/"><strong>VIEW ALL PRODUCTS</strong></=
a></p>
</body>
</body>
</html>

------=_NextPart_000_0006_01BF5424.44B32450--

--DELIMITER
Content-Disposition: attachment; filename=signature.asc
Content-Type: multipart/signed; boundary="BOUNDARY";  protocol="application/pgp-signature" 
--BOUNDARY
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable
 SHA1

Otherwise clients joining the room won't be able to convert other clients'
channel-specific handles into global handles in order to make Buddy objects,
because they're not the moderator of the room.
- ---
 services/presence/server_plugin.py |   47 ++++++++++++++++++++++++++++++-----
 1 files changed, 40 insertions(+), 7 deletions(-)

diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
index 6b21888..18b4776 100644
- --- a/services/presence/server_plugin.py
+++ b/services/presence/server_plugin.py
@@ -30,12 +30,14 @@ import psutils
 from telepathy.client import ConnectionManager, ManagerRegistry, Connection, Channel
 from telepathy.interfaces import (
     CONN_MGR_INTERFACE, CONN_INTERFACE, CHANNEL_TYPE_CONTACT_LIST, CHANNEL_INTERFACE_GROUP, CONN_INTERFACE_ALIASING,
- -    CONN_INTERFACE_AVATARS, CONN_INTERFACE_PRESENCE, CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA)
+    CONN_INTERFACE_AVATARS, CONN_INTERFACE_PRESENCE, CHANNEL_TYPE_TEXT, CHANNEL_TYPE_STREAMED_MEDIA,
+    PROPERTIES_INTERFACE)
 from telepathy.constants import (
     CONNECTION_HANDLE_TYPE_NONE, CONNECTION_HANDLE_TYPE_CONTACT,
     CONNECTION_STATUS_CONNECTED, CONNECTION_STATUS_DISCONNECTED, CONNECTION_STATUS_CONNECTING,
     CONNECTION_HANDLE_TYPE_LIST, CONNECTION_HANDLE_TYPE_CONTACT, CONNECTION_HANDLE_TYPE_ROOM,
- -    CONNECTION_STATUS_REASON_AUTHENTICATION_FAILED)
+    CONNECTION_STATUS_REASON_AUTHENTICATION_FAILED,
+    PROPERTY_FLAG_WRITE)
 
 CONN_INTERFACE_BUDDY_INFO = 'org.laptop.Telepathy.BuddyInfo'
 CONN_INTERFACE_ACTIVITY_PROPERTIES = 'org.laptop.Telepathy.ActivityProperties'
@@ -422,12 +424,43 @@ class ServerPlugin(gobject.GObject):
                 reply_handler=self._set_self_avatar_cb,
                 error_handler=lambda *args: self._log_error_cb("setting avatar", *args))
 
- -    def _join_activity_create_channel_cb(self, activity_id, signal, handle, userdata, chan_path):
- -        channel = Channel(self._conn._dbus_object._named_service, chan_path)
+    def _join_activity_channel_props_set_cb(self, activity_id, signal, handle, channel, userdata):
         self._joined_activities.append((activity_id, handle))
         self._set_self_activities()
         self.emit(signal, activity_id, channel, None, userdata)
 
+    def _join_activity_channel_props_listed_cb(self, activity_id, signal, handle, channel, userdata, props, prop_specs):
+
+        props_to_set = []
+        for ident, name, sig, flags in prop_specs:
+            value = props.pop(name, None)
+            if value is not None:
+                if flags & PROPERTY_FLAG_WRITE:
+                    props_to_set.append((ident, value))
+                # FIXME: else error, but only if we're creating the room?
+        # FIXME: if props is nonempty, then we want to set props that aren't
+        # supported here - raise an error?
+
+        if props_to_set:
+            channel[PROPERTIES_INTERFACE].SetProperties(props_to_set,
+                reply_handler=lambda: self._join_activity_channel_props_set_cb(activity_id, signal, handle, channel, userdata),
+                error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'SetProperties(%r)' % props_to_set, e))
+        else:
+            self._join_activity_channel_props_set_cb(activity_id, signal, handle, channel, userdata)
+
+    def _join_activity_create_channel_cb(self, activity_id, signal, handle, userdata, chan_path):
+        channel = Channel(self._conn._dbus_object._named_service, chan_path)
+        props = {
+            'anonymous': False,         # otherwise buddy resolution breaks
+            'invite-only': False,       # XXX: should be True in future
+            #'name': ...                # XXX: set from activity name?
+            'persistent': False,        # vanish when there are no members
+            'private': False,           # XXX: should be True unless public
+        }
+        channel[PROPERTIES_INTERFACE].ListProperties(
+            reply_handler=lambda prop_specs: self._join_activity_channel_props_listed_cb(activity_id, signal, handle, channel, userdata, props, prop_specs),
+            error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'ListProperties', e))
+
     def _join_activity_get_channel_cb(self, activity_id, signal, userdata, handles):
         if not self._activities.has_key(activity_id):
             self._activities[activity_id] = handles[0]
@@ -441,10 +474,10 @@ class ServerPlugin(gobject.GObject):
         self._conn[CONN_INTERFACE].RequestChannel(CHANNEL_TYPE_TEXT,
             CONNECTION_HANDLE_TYPE_ROOM, handles[0], True,
             reply_handler=lambda *args: self._join_activity_create_channel_cb(activity_id, signal, handles[0], userdata, *args),
- -            error_handler=lambda *args: self._join_error_cb(activity_id, signal, userdata, *args))
+            error_handler=lambda e: self._join_error_cb(activity_id, signal, userdata, 'RequestChannel(TEXT, ROOM, %r, True)' % handles[0], e))
 
- -    def _join_error_cb(self, activity_id, signal, userdata, err):
- -        e = Exception("Error joining/sharing activity %s: %s" % (activity_id, err))
+    def _join_error_cb(self, activity_id, signal, userdata, where, err):
+        e = Exception("Error joining/sharing activity %s: (%s): %s" % (activity_id, err))
         _logger.debug(str(e))
         self.emit(signal, activity_id, None, e, userdata)
 
- -- 
1.5.2-rc3.GIT

--BOUNDARY
Content-Type: application/pgp-signature; name="signature.asc"
BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGUxElWSc8zVUw7HYRApw4AJwO+/ndtybiTFPQEI35meJuyPzN5wCfUQWo
EafNRdOl/ITBL5VY7N34abk=
=piEB
-----END PGP SIGNATURE-----
_____
-BOUNDARY--
--DELIMITER--
