From: <David_Lachance@amat.com>
To: aggie74@swbell.com
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
0
Content-Type: text/html; charset=ISO-8859-1
Status: O
Content-Length: 7062
Lines: 77

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252"><title>251839499</title></head><body><!-- <a href="http://EducationRangeNow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&amp;cid=292902&amp;em=producttestpanel@speedy.uwaterloo.ca&amp;id=23482&amp;nid=6">&nbsp;-&nbsp;</a> //--><p align=center STYLE="font-size: 10pt; font-family:Arial">If you cannot see the graphics in this email, <a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485">click here</a>.  You must be 18 years old to participate.</p><p><IMG SRC="http://rangenow.com/cgi-bin/open_email1.cgi?id=251839499&amp;cid=292902&amp;f=6568&amp;s=10521&amp;c=6485&amp;" border=0 height=1 width=1>
<center>
<table width="538" border="0" cellspacing="0" cellpadding="0">
  <tr align="left" valign="top">
    <td colspan="2"><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank><img src="http://rangepower.com/images/zebew_6485/sireg_1.jpg" width="549" height="278" border="0"></a></td>
  </tr>
  <tr>
    <td colspan="2"><table width="100%"  border="0" cellspacing="12" cellpadding="0" style="font-family:Geneva, Arial, Helvetica, sans-serif; font-size:12px; color:#333333">
      <tr>
        <td align="left" valign="top">Kaplan University is an online institution of higher learning dedicated
          to providing innovative undergraduate, graduate, and continuing professional
          education. At Kaplan University, you earn a college degree on your
          terms. We give you the control to schedule your education. There are
          no job interruptions, travel expenses, or hours spent searching the
          campus map. Study from home with online course work, at your won pace,
          while you work. <a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Receive free info today!</a></td>
      </tr>
    </table></td>
  </tr>
  <tr background="http://rangepower.com/images/zebew_6485/loleh_2.jpg">
    <td width="234" align="left" valign="top"><img src="http://rangepower.com/images/zebew_6485/wiyig_3.jpg" width="234" height="129"></td>
    <td width="304" align="left" valign="middle"><table width="303"  border="0" cellpadding="0" cellspacing="2" style="font-family:Geneva, Arial, Helvetica, sans-serif; font-size:12px; color:#333333">
      <tr>
        <td width="3"></td>
        <td colspan="7"><img src="http://rangepower.com/images/zebew_6485/nilaw_4.gif" width="266" height="24"></td>
        </tr>
      <tr>
        <td></td>
        <td width="5"></td>
        <td width="13" height="9" align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td width="107" align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Business</a></strong></td>
        <td width="11" align="left" valign="top"></td>
        <td width="13" align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td width="96" align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Healthcare</a></strong></td>
        <td width="51" align="left" valign="top"></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td width="13" height="9" align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Criminal Justice</a> </strong></td>
        <td align="left" valign="top"></td>
        <td align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Paralegal</a></strong></td>
        <td align="left" valign="top"></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td width="13" height="9" align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Education</a></strong></td>
        <td align="left" valign="top"></td>
        <td align="center" valign="middle"><img src="http://rangepower.com/images/zebew_6485/xewug_5.jpg" width="9" height="8"></td>
        <td align="left" valign="top"><strong><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank>Technology</a></strong></td>
        <td align="left" valign="top"></td>
      </tr>
    </table></td>
  </tr>
  <tr align="center" valign="middle">
    <td colspan="2" background="http://rangepower.com/images/zebew_6485/loleh_2.jpg"><a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&cid=292902&id=129293&f=6568&s=10521&c=6485" target=_blank><br>
    <img src="http://rangepower.com/images/zebew_6485/kuxeh_12.jpg" width="189" height="26" border="0"></a><br>
    <br></td>
  </tr>
</table>
</center>
<p><HR width="90%" SIZE=1><p><center>
<table cellspacing=0 cellpadding=0 width=600 border=0>
<tr><td align=center>
<font face="Verdana,Arial" size="1">
</font>
<br>
<a href="http://EducationRangeNow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&amp;cid=0&amp;em=producttestpanel@speedy.uwaterloo.ca&amp;id=122764" target="_blank"><img src="http://www.rangepower.com/images/unsub/1405_unsub.gif" border=0></a><br><br><a href="http://EducationRangeNow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&amp;cid=292902&amp;em=producttestpanel@speedy.uwaterloo.ca&amp;id=42&amp;nid=6" target=_blank><img src="http://www.rangepower.com/fimg/356_1.jpg" border=0></a><br><a href="http://EducationRangeNow.rangenow.com/cgi-bin/redir1.cgi?cid=0&amp;eid=251839499&amp;id=51&amp;nid=6" target=_blank><img src="http://www.rangepower.com/fimg/356_2.jpg" border=0></a> 
</td></tr></table></center></p>

<p align=center STYLE="font-size:10pt; font-family:Arial">To unsubscribe: <a href="http://educationrangenow.rangenow.com/cgi-bin/redir1.cgi?eid=251839499&amp;cid=292902&amp;id=42&amp;nid=6">follow this link</a>.<br><br>Send postal mail to: 1202 Lexington Avenue, Suite 214 New York, NY 10025<br><br></p></body></html>

.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
Content-Type: text/plain

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

>  /*
> @@ -602,6 +609,39 @@
>  static NTSTATUS ipc_qfileinfo(struct ntvfs_module_context *ntvfs,
>  			      struct ntvfs_request *req, union smb_fileinfo *info)
>  {
> +	struct ipc_private *private = ntvfs->private_data;
> +	switch (info->generic.level) {
> +	case RAW_FILEINFO_GENERIC: 
> +	{
> +		struct pipe_state *p;
> +		p = pipe_state_find(private, info->generic.in.file.ntvfs);
> +		if (!p) {
> +			return NT_STATUS_INVALID_HANDLE;
> +		}
> +		ZERO_STRUCT(info->generic.out);
> +		info->generic.out.attrib = FILE_ATTRIBUTE_NORMAL;
> +		info->generic.out.fname.s = strrchr(p->pipe_name, '\\');
> +		info->generic.out.alloc_size = 4096;
> +		info->generic.out.nlink = 1;
> +		/* What the heck?  Match Win2k3: IPC$ pipes are delete pending */
> +		info->generic.out.delete_pending = 1;
> +		return NT_STATUS_OK;
> +	}
> +	case RAW_FILEINFO_ALT_NAME_INFO:
> +	case RAW_FILEINFO_ALT_NAME_INFORMATION:
> +	case RAW_FILEINFO_STREAM_INFO:
> +	case RAW_FILEINFO_STREAM_INFORMATION:
> +	case RAW_FILEINFO_COMPRESSION_INFO:
> +	case RAW_FILEINFO_COMPRESSION_INFORMATION:
> +	case RAW_FILEINFO_NETWORK_OPEN_INFORMATION:
> +	case RAW_FILEINFO_ATTRIBUTE_TAG_INFORMATION:
> +		return NT_STATUS_INVALID_PARAMETER;
> +	case  RAW_FILEINFO_ALL_EAS:
> +		return NT_STATUS_ACCESS_DENIED;
> +	default:
> +		return ntvfs_map_qfileinfo(ntvfs, req, info);
> +	}
> +	

Hi Andrew,

are you sure that the other levels always give INVALID_PARAMETER and
not INVALID_HANDLE even if the handle isn't valid?

metze
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)
Comment: Using GnuPG with SUSE - http://enigmail.mozdev.org

iD8DBQFGSVZ7m70gjA5TCD8RAtMoAKCQHkztz8DAnECZTyolvP/Gnte5bACfVxFP
JNf05JOVmuVY+duAjx2I6mg=
=ucTV
-----END PGP SIGNATURE-----
-BOUNDARY--
