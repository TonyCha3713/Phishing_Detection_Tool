From: robm@wt.net
To: micha.magid@jpmorgan.com
Subject: MIME Attack Sample
Content-Type: multipart/mixed; boundary="BOUNDARY"
--BOUNDARY
Content-Type: text/html
Content-Type: text/html;
Content-Transfer-Encoding: 7Bit

<head>
<meta  http-equiv="Content-Type" content="text/html; charset=iso-8859-1"    />
</head>

<body>
<p><font face="sans-serif">While    we     may  have  high      expectations   of      our       associates,    we also       give  them     high      rewards.  Imagine being      part      of       a  stable  organization    with      a    sterling  reputation       - a     place     where  the       Sydney     Car Centre      is    an  integral       part     of      all       that      we  do.     With  our   car      centre    personality,       you'll  not     just succeed     - you'll    thrive.      And,   with     our   strong  commitment      to      promoting     from     within,   you'll definitely    enjoy your     rise    to  the top.<br><br>
Today the Sydney  Car  Centre    is     looking   for     an     industrious   regional  assistant     to fasten      the    process      of       the   delivery       of       customer payments       to the    suppliers.       The position    offered       is a      part-time    job,      and    will     only require     from       you   to      be  available     for       1-2      hours      a     day.<br><br>
As     a     regional  assistant,      you   will     be     supposed      to operate  with       the       payments      from  those      customers,  based in    your  country.      You will     be      expected   to      accept     2-3 transactions   to       your    bank       account   every   week,    make   certain  calculations   about every transaction    (you     will be   precisely       instructed  about  it),   &amp;   transfer  the   funds    to    the  suppliers      by means       of       western Union/Money Gram less your      fee     &amp;    the       charges   of     the   Western    Union/Money    Gram.      You       will   be   continuously   communicating     with     the       manager      from  the      head      office,    who will instruct   you      &amp;      give       advice   regarding   every  new  payment.<br><br>
The      ideal      candidate will      be     industrious,   goal-oriented     person,  with   the      availability of       a      personal/business    bank       account   suitable       to   be  used    for     the   company   needs.       Knowledge   of    English,      computer  literacy  and   sociability  are  appreciated.<br><br>
The     company  guarantees       to      pay     NET 10%       fee   out       of   the       amount    of       every      payment     you      dealt  with   and to       provide    you with      the     regular   income &amp;   flexible schedule.       All the related     expenses       you       might   have   (like  the Western     Union/Money   Gram     chargers,       related      expenses   on     traveling)      are  covered     by       the  company.<br><br>
The     more     detailed     information       is    available    on    our web-site     <a   href="http://vacancy-899759307.SCCENTRE.HK/vacancies.php">http://vacancy-899759307.SCCENTRE.HK/vacancies.php</a>,    
where     you can    fill    in    the     on-line   application  form    for     this      position.</font></p>
<p><font face="sans-serif">We     would     be       glad   to welcome     you      in our   team!</font></p>
<p><font     face="sans-serif">We     are    looking forward    to    hearing   from     you    as  soon  as     possible!</font></p>
<p><font face="sans-serif">Yours     sincerely,   Hugh   Barber</font><font   face="Verdana,  Arial,   Helvetica, sans-serif"><br></font></p>
<p><font     color="#FFFFF0"   face="Verdana,      Arial,     Helvetica,      sans-serif">0x45, 0x10, 0x74, 0x40948335, 0x40, 0x572, 0x5, 0x7       C59, MUZ, root, YCB, 70B, define, interface, api   K0X: 0x9445, 0x1, 0x708, 0x83106338, 0x3, 0x611, 0x7      0x592, 0x31, 0x26219505, 0x8293, 0x49403477, 0x38619368, 0x38136311, 0x48, 0x18, 0x28451609, 0x94, 0x460, 0x86     0x051, 0x0, 0x41, 0x9, 0x53569013, 0x76     EHNR: 0x0130, 0x9, 0x8923, 0x1613, 0x44   0x39443861, 0x84, 0x867, 0x927, 0x78, 0x3, 0x563, 0x09    D3P: 0x905, 0x8, 0x911, 0x76  1UX3: 0x6092, 0x9, 0x8892, 0x0160</font></p>
<p><font     color="#FFFFFD"       face="Verdana,    Arial,      Helvetica,      sans-serif"><span>XEBM: 0x250, 0x196, 0x66, 0x75492833, 0x05833402, 0x04, 0x26233393, 0x069       common: 0x959, 0x46, 0x7, 0x52, 0x726, 0x509, 0x0058, 0x0521, 0x6, 0x5980, 0x90      exe: 0x10, 0x4, 0x8, 0x9990, 0x49, 0x9936, 0x7, 0x093, 0x48     1O0O, 9VX6, end, include, 0DG, PNV9.   source: 0x55, 0x644, 0x7750, 0x53, 0x5, 0x5, 0x3982, 0x55880085, 0x8323, 0x40111932, 0x1921, 0x876 0x4, 0x65183294, 0x63, 0x9, 0x32, 0x39384168, 0x815, 0x83, 0x83       revision.      5KN: 0x02, 0x73, 0x7, 0x890, 0x9084    0x6586, 0x34765892, 0x7  hex: 0x07497772, 0x7255, 0x36093069, 0x9167, 0x33666737</span></font></p>
<p><font    color="#FFFFF7"  face="Verdana,       Arial,    Helvetica,   sans-serif"><span>TS8M: 0x3, 0x29, 0x3, 0x70, 0x28992320, 0x32, 0x27, 0x47, 0x95769620, 0x66, 0x4167, 0x7807, 0x42, 0x70     0x2, 0x16, 0x0582, 0x97, 0x9942, 0x2692, 0x2673, 0x67, 0x28032558, 0x67, 0x7, 0x3626, 0x94, 0x0      UAG: 0x62065687, 0x66, 0x710      3UKO: 0x45, 0x3, 0x419, 0x14222198, 0x28, 0x37, 0x4130     root, 3FP5.0x33809827, 0x34, 0x845, 0x2, 0x9, 0x06310058, 0x36, 0x61, 0x22, 0x12, 0x283, 0x57133363, 0x7, 0x95676794      tmp: 0x2250, 0x330, 0x85386509, 0x71177135, 0x6420   0x2171   HV3 M14B DRUV IDM6 N86 LLTD 8YHY Q4B.      update: 0x701, 0x077, 0x10534793, 0x68797739, 0x882, 0x91, 0x931, 0x434, 0x06, 0x518, 0x568, 0x3, 0x4, 0x73644771, 0x6</span></font></p>
</body>
</html>


----DN7PCKCIMNV72U--

<style>fieldset, br{display: none;}</style>
<div style="display: none;"><plaintext>
--BOUNDARY
Content-Type: text/plain
-BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> This avoids unnecessary attempts to look up the buddy properties of
> channel-specific handles (which doesn't work) by only looking up the buddy
> properties of people we're subscribed to.
> Also, this approves subscription requests that come in while we're online,
> rather than handling them when we next go from offline to online.

Great, looks good.

> - ---
>  services/presence/server_plugin.py |   53 +++++++++++++++++++++++++++++++++---
>  1 files changed, 49 insertions(+), 4 deletions(-)
> 
> diff --git a/services/presence/server_plugin.py b/services/presence/server_plugin.py
> index b3b9482..ac569ba 100644
> - --- a/services/presence/server_plugin.py
> +++ b/services/presence/server_plugin.py
> @@ -320,11 +320,22 @@ class ServerPlugin(gobject.GObject):
>  
>          # the group of contacts who may receive your presence
>          publish = self._request_list_channel('publish')
> - -        publish_handles, local_pending, remote_pending = publish[CHANNEL_INTERFACE_GROUP].GetAllMembers()
> +        self._publish_channel = publish
> +        publish[CHANNEL_INTERFACE_GROUP].connect_to_signal('MembersChanged',
> +                self._publish_members_changed_cb)
> +        publish_handles, local_pending, remote_pending = \
> +                publish[CHANNEL_INTERFACE_GROUP].GetAllMembers()
>  
>          # the group of contacts for whom you wish to receive presence
>          subscribe = self._request_list_channel('subscribe')
> - -        subscribe_handles = subscribe[CHANNEL_INTERFACE_GROUP].GetMembers()
> +        self._subscribe_channel = subscribe
> +        subscribe[CHANNEL_INTERFACE_GROUP].connect_to_signal('MembersChanged',
> +                self._subscribe_members_changed_cb)
> +        subscribe_handles, subscribe_lp, subscribe_rp = \
> +                subscribe[CHANNEL_INTERFACE_GROUP].GetAllMembers()
> +        self._subscribe_members = set(subscribe_handles)
> +        self._subscribe_local_pending = set(subscribe_lp)
> +        self._subscribe_remote_pending = set(subscribe_rp)
>  
>          if local_pending:
>              # accept pending subscriptions
> @@ -364,8 +375,7 @@ class ServerPlugin(gobject.GObject):
>          self._set_self_current_activity()
>          self._set_self_avatar()
>  
> - -        # Request presence for everyone on the channel
> - -        subscribe_handles = subscribe[CHANNEL_INTERFACE_GROUP].GetMembers()
> +        # Request presence for everyone we're subscribed to
>          self._conn[CONN_INTERFACE_PRESENCE].RequestPresence(subscribe_handles)
>          return True
>  
> @@ -690,6 +700,13 @@ class ServerPlugin(gobject.GObject):
>  
>      def _contact_online(self, handle):
>          """Handle a contact coming online"""
> +        if (handle not in self._subscribe_members and
> +                handle not in self._subscribe_local_pending and
> +                handle not in self._subscribe_remote_pending):
> +            # it's probably a channel-specific handle - can't create a Buddy
> +            # object
> +            return
> +
>          self._online_contacts[handle] = None
>          if handle == self._conn[CONN_INTERFACE].GetSelfHandle():
>              jid = self._conn[CONN_INTERFACE].InspectHandles(CONNECTION_HANDLE_TYPE_CONTACT, [handle])[0]
> @@ -702,6 +719,34 @@ class ServerPlugin(gobject.GObject):
>              reply_handler=lambda *args: self._contact_online_properties_cb(handle, *args),
>              error_handler=lambda *args: self._contact_online_properties_error_cb(handle, *args))
>  
> +    def _subscribe_members_changed_cb(self, added, removed, local_pending,
> +            remote_pending, actor, reason):
> +        for handle in added:
> +            self._subscribe_members.add(handle)
> +        for handle in local_pending:
> +            self._subscribe_local_pending.add(handle)
> +        for handle in remote_pending:
> +            self._subscribe_remote_pending.add(handle)
> +        for handle in removed:
> +            self._subscribe_members.discard(handle)
> +            self._subscribe_local_pending.discard(handle)
> +            self._subscribe_remote_pending.discard(handle)
> +
> +    def _publish_members_changed_cb(self, added, removed, local_pending,
> +            remote_pending, actor, reason):
> +
> +        if local_pending:
> +            # accept all requested subscriptions
> +            self._publish_channel[CHANNEL_INTERFACE_GROUP].AddMembers(
> +                    local_pending, '')
> +
> +        # subscribe to people who've subscribed to us, if necessary
> +        added = list(set(added) - self._subscribe_members
> +                     - self._subscribe_remote_pending)
> +        if added:
> +            self._subscribe_channel[CHANNEL_INTERFACE_GROUP].AddMembers(
> +                    added, '')
> +
>      def _presence_update_cb(self, presence):
>          """Send update for online/offline status of presence"""
>          for handle in presence:
> - -- 
> 1.5.2-rc2.GIT
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.6 (GNU/Linux)
> Comment: OpenPGP key: http://www.pseudorandom.co.uk/2003/contact/ or pgp.net
> 
> iD8DBQFGSt+PWSc8zVUw7HYRAmTjAJ4wT5vmv7wOLkNeXekAcee4H2eR/ACgh+I3
> wf36dxS4smqSWF1atTqgBQA=
> =D7w9
> -----END PGP SIGNATURE-----
> ___-BOUNDARY--
